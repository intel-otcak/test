From 170eadde9aeb0e620d669e3e4624e1d02e137007 Mon Sep 17 00:00:00 2001
From: sys_icgvert <icgvert@intel.com>
Date: Tue, 8 Mar 2016 17:09:43 -0800
Subject: [PATCH 1/5] atomisp2: css2400 and 2401 irci_ecr-master_20160308_0202

Merge CSS2.1 for css2400 and 2401_legacy for
irci_ecr-master_20160308_0202 firmware tag

Change-Id: I8df1092b5809ce86638474fe922055445832be73
Signed-off-by: sys_icgvert <icgvert@intel.com>
Reviewed-on: https://icggerrit.ir.intel.com/106402
Reviewed-by: ManishX Gotefode <manishx.gotefode@intel.com>
Build: Dessert M BXT RVP (SC)
Approver: WeiX Meng <weix.meng@intel.com>
Integrator: WeiX Meng <weix.meng@intel.com>
Build: Dessert M CHT FFD (SC)
Reviewed-by: WeiX Meng <weix.meng@intel.com>
Tracked-On: https://jira01.devtools.intel.com/browse/OAM-22830
Signed-off-by: Tao Wei <wei.tao@intel.com>
Reviewed-on: https://android.intel.com:443/480578
---
 .../ia_css_isp_params.c                            |  89 +++++
 .../ia_css_isp_params.h                            |   9 +
 .../pci/atomisp2/css/css_2400_system/spmem_dump.c  | 392 +++++++++++----------
 .../ia_css_isp_params.c                            |  89 +++++
 .../ia_css_isp_params.h                            |   9 +
 .../css/css_2401_csi2p_system/spmem_dump.c         | 356 ++++++++++---------
 .../ia_css_isp_params.c                            |  89 +++++
 .../ia_css_isp_params.h                            |   9 +
 .../pci/atomisp2/css/css_2401_system/spmem_dump.c  | 388 ++++++++++----------
 .../media/pci/atomisp2/css/css_api_version.h       |  15 +-
 .../camera/drivers/media/pci/atomisp2/css/ia_css.h |   2 +-
 .../drivers/media/pci/atomisp2/css/ia_css_err.h    |  11 +
 .../media/pci/atomisp2/css/ia_css_frame_public.h   |  15 +
 .../drivers/media/pci/atomisp2/css/ia_css_stream.h |   1 +
 .../media/pci/atomisp2/css/ia_css_stream_public.h  |   5 +
 .../drivers/media/pci/atomisp2/css/ia_css_types.h  |   5 +-
 .../media/pci/atomisp2/css/ia_css_version_data.h   |   2 +-
 .../css/isp/kernels/bnlm/ia_css_bnlm.host.c        | 170 +++++++--
 .../css/isp/kernels/bnlm/ia_css_bnlm.host.h        |   2 +-
 .../isp/kernels/bnlm/ia_css_bnlm_default.host.c    |   8 +-
 .../css/isp/kernels/bnlm/ia_css_bnlm_types.h       |  10 +-
 .../css/isp/kernels/tdf/tdf_1.0/ia_css_tdf.host.c  |   4 +-
 .../atomisp2/css/isp/modes/interface/isp_const.h   |  15 +-
 .../runtime/frame/interface/ia_css_frame_comm.h    |   7 +-
 .../pci/atomisp2/css/runtime/frame/src/frame.c     |   1 +
 .../tagger/interface/ia_css_tagger_common.h        |   1 +
 .../camera/drivers/media/pci/atomisp2/css/sh_css.c |  17 +-
 .../media/pci/atomisp2/css/sh_css_firmware.c       |   4 +-
 .../media/pci/atomisp2/css/sh_css_internal.h       |   1 +
 .../media/pci/atomisp2/css/sh_css_param_shading.c  |   5 -
 .../drivers/media/pci/atomisp2/css/sh_css_params.c |   3 +
 .../drivers/media/pci/atomisp2/css/sh_css_params.h |   1 +
 .../drivers/media/pci/atomisp2/css/sh_css_sp.c     |   6 +
 .../drivers/media/pci/atomisp2/css/sh_css_sp.h     |   3 +
 34 files changed, 1131 insertions(+), 613 deletions(-)

diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.c
index 5e293e8..70bf169 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.c
@@ -396,6 +396,56 @@ size);
 /* Code generated by genparam/gencode.c:gen_process_function() */
 
 static void
+ia_css_process_bnlm(
+	unsigned pipe_id,
+	const struct ia_css_pipeline_stage *stage,
+	struct ia_css_isp_parameters *params)
+{
+	assert(params != NULL);
+
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_encode((struct bnlm_dmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_DMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_DMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_vmem_encode((struct bnlm_vmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_VMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_VMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+}
+
+/* Code generated by genparam/gencode.c:gen_process_function() */
+
+static void
 ia_css_process_eed1_8(
 	unsigned pipe_id,
 	const struct ia_css_pipeline_stage *stage,
@@ -1913,6 +1963,7 @@ void (* ia_css_kernel_process_param[IA_CSS_NUM_PARAMETER_IDS])(
 	ia_css_process_dp,
 	ia_css_process_bnr,
 	ia_css_process_dpc2,
+	ia_css_process_bnlm,
 	ia_css_process_eed1_8,
 	ia_css_process_de,
 	ia_css_process_ecd,
@@ -2033,6 +2084,42 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_get_function() */
 
 static void
+ia_css_get_bnlm_config(const struct ia_css_isp_parameters *params,
+			struct ia_css_bnlm_config *config){
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() enter: "
+		"config=%p\n",config);
+
+	*config = params->bnlm_config;
+
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() leave\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+}
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config)
+{
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "ia_css_set_bnlm_config() enter:\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+	params->bnlm_config = *config;
+	params->config_changed[IA_CSS_BNLM_ID] = true;
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_set_bnlm_config() leave: "
+		"return_void\n");
+}
+
+/* Code generated by genparam/gencode.c:gen_get_function() */
+
+static void
 ia_css_get_eed1_8_config(const struct ia_css_isp_parameters *params,
 			struct ia_css_eed1_8_config *config){
 	if (config == NULL)
@@ -3576,6 +3663,7 @@ ia_css_get_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_get_dp_config(params, config->dp_config);
 	ia_css_get_dpc2_config(params, config->dpc2_config);
+	ia_css_get_bnlm_config(params, config->bnlm_config);
 	ia_css_get_eed1_8_config(params, config->eed1_8_config);
 	ia_css_get_wb_config(params, config->wb_config);
 	ia_css_get_tnr_config(params, config->tnr_config);
@@ -3628,6 +3716,7 @@ ia_css_set_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_set_dp_config(params, config->dp_config);
 	ia_css_set_dpc2_config(params, config->dpc2_config);
+	ia_css_set_bnlm_config(params, config->bnlm_config);
 	ia_css_set_eed1_8_config(params, config->eed1_8_config);
 	ia_css_set_wb_config(params, config->wb_config);
 	ia_css_set_tnr_config(params, config->tnr_config);
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.h
index 3acdc0c..2b971c8 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/hive_isp_css_2400_system_generated/ia_css_isp_params.h
@@ -29,6 +29,7 @@ enum ia_css_parameter_ids {
 	IA_CSS_DP_ID,
 	IA_CSS_BNR_ID,
 	IA_CSS_DPC2_ID,
+	IA_CSS_BNLM_ID,
 	IA_CSS_EED1_8_ID,
 	IA_CSS_DE_ID,
 	IA_CSS_ECD_ID,
@@ -88,6 +89,7 @@ struct ia_css_memory_offsets {
 		struct ia_css_isp_parameter dp;
 		struct ia_css_isp_parameter bnr;
 		struct ia_css_isp_parameter dpc2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter de;
 		struct ia_css_isp_parameter ecd;
@@ -129,6 +131,7 @@ struct ia_css_memory_offsets {
 	} dmem;
 	struct {
 		struct ia_css_isp_parameter anr2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter ob;
 		struct ia_css_isp_parameter macc1_5;
@@ -186,6 +189,12 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_set_function() */
 
 void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config);
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
 ia_css_set_eed1_8_config(struct ia_css_isp_parameters *params,
 			const struct ia_css_eed1_8_config *config);
 
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/spmem_dump.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/spmem_dump.c
index 2ca19b4..a3696ea 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/spmem_dump.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2400_system/spmem_dump.c
@@ -23,7 +23,7 @@ more details.
 
 /* function input_system_acquisition_stop: AD8 */
 
-/* function longjmp: 69DF */
+/* function longjmp: 6C0A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SRST_MASK
@@ -37,11 +37,11 @@ more details.
 #define HIVE_ADDR_sp_HIVE_IF_SRST_MASK 0x1C8
 #define HIVE_SIZE_sp_HIVE_IF_SRST_MASK 16
 
-/* function tmpmem_init_dmem: 66D9 */
+/* function tmpmem_init_dmem: 6904 */
 
-/* function ia_css_isys_sp_token_map_receive_ack: 601D */
+/* function ia_css_isys_sp_token_map_receive_ack: 6248 */
 
-/* function ia_css_dmaproxy_sp_set_addr_B: 351D */
+/* function ia_css_dmaproxy_sp_set_addr_B: 3715 */
 
 /* function ia_css_pipe_data_init_tagger_resources: A4F */
 
@@ -61,13 +61,13 @@ more details.
 #define HIVE_ADDR_sp_vbuf_mipi 0x6508
 #define HIVE_SIZE_sp_vbuf_mipi 12
 
-/* function ia_css_event_sp_decode: 370E */
+/* function ia_css_event_sp_decode: 3906 */
 
-/* function ia_css_queue_get_size: 4B36 */
+/* function ia_css_queue_get_size: 4D2E */
 
-/* function ia_css_queue_load: 514D */
+/* function ia_css_queue_load: 5345 */
 
-/* function setjmp: 69E8 */
+/* function setjmp: 6C13 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_sp2host_isys_event_queue
@@ -81,11 +81,11 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_isys_event_queue 0x4860
 #define HIVE_SIZE_sp_sem_for_sp2host_isys_event_queue 20
 
-/* function ia_css_dmaproxy_sp_wait_for_ack: 6F69 */
+/* function ia_css_dmaproxy_sp_wait_for_ack: 7194 */
 
-/* function ia_css_sp_rawcopy_func: 5387 */
+/* function ia_css_sp_rawcopy_func: 557F */
 
-/* function ia_css_tagger_buf_sp_pop_marked: 2B96 */
+/* function ia_css_tagger_buf_sp_pop_marked: 2D8E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_stage
@@ -111,9 +111,9 @@ more details.
 #define HIVE_ADDR_sp_vbuf_raw 0x314
 #define HIVE_SIZE_sp_vbuf_raw 4
 
-/* function ia_css_sp_bin_copy_func: 52AD */
+/* function ia_css_sp_bin_copy_func: 54A5 */
 
-/* function ia_css_queue_item_store: 4E9B */
+/* function ia_css_queue_item_store: 5093 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_metadata_bufs
@@ -167,7 +167,7 @@ more details.
 
 /* function ia_css_thread_sp_main: D50 */
 
-/* function ia_css_ispctrl_sp_init_internal_buffers: 394F */
+/* function ia_css_ispctrl_sp_init_internal_buffers: 3B47 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_psys_event_queue_handle
@@ -193,7 +193,9 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_psys_event_queue 0x4874
 #define HIVE_SIZE_sp_sem_for_sp2host_psys_event_queue 20
 
-/* function ia_css_tagger_sp_propagate_frame: 245D */
+/* function ia_css_tagger_buf_sp_get_capture_from_start: 2C7C */
+
+/* function ia_css_tagger_sp_propagate_frame: 2490 */
 
 /* function input_system_reg_load: B11 */
 
@@ -209,17 +211,17 @@ more details.
 #define HIVE_ADDR_sp_vbuf_handles 0x6514
 #define HIVE_SIZE_sp_vbuf_handles 960
 
-/* function ia_css_queue_store: 5001 */
+/* function ia_css_queue_store: 51F9 */
 
-/* function ia_css_sp_flash_register: 2DCB */
+/* function ia_css_sp_flash_register: 2FC3 */
 
-/* function ia_css_isys_sp_backend_create: 5C90 */
+/* function ia_css_isys_sp_backend_create: 5EBB */
 
-/* function ia_css_pipeline_sp_init: 186B */
+/* function ia_css_pipeline_sp_init: 187B */
 
-/* function ia_css_tagger_sp_configure: 234D */
+/* function ia_css_tagger_sp_configure: 2380 */
 
-/* function ia_css_ispctrl_sp_end_binary: 3757 */
+/* function ia_css_ispctrl_sp_end_binary: 394F */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_per_frame_ddr_ptrs
@@ -283,7 +285,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_com 0x428C
 #define HIVE_SIZE_sp_host_sp_com 220
 
-/* function ia_css_queue_get_free_space: 4C60 */
+/* function ia_css_queue_get_free_space: 4E58 */
 
 /* function exec_image_pipe: 658 */
 
@@ -299,19 +301,19 @@ more details.
 #define HIVE_ADDR_sp_sp_init_dmem_data 0x649C
 #define HIVE_SIZE_sp_sp_init_dmem_data 24
 
-/* function ia_css_sp_metadata_start: 5A6D */
+/* function ia_css_sp_metadata_start: 5C98 */
 
-/* function ia_css_bufq_sp_init_buffer_queues: 2E3A */
+/* function ia_css_bufq_sp_init_buffer_queues: 3032 */
 
-/* function ia_css_pipeline_sp_stop: 184E */
+/* function ia_css_pipeline_sp_stop: 185E */
 
-/* function ia_css_tagger_sp_connect_pipes: 2837 */
+/* function ia_css_tagger_sp_connect_pipes: 2966 */
 
 /* function sp_isys_copy_wait: 6A1 */
 
 /* function is_isp_debug_buffer_full: 337 */
 
-/* function ia_css_dmaproxy_sp_configure_channel_from_info: 348D */
+/* function ia_css_dmaproxy_sp_configure_channel_from_info: 3685 */
 
 /* function encode_and_post_timer_event: 9C4 */
 
@@ -327,7 +329,7 @@ more details.
 #define HIVE_ADDR_sp_sp_per_frame_data 0x4368
 #define HIVE_SIZE_sp_sp_per_frame_data 4
 
-/* function ia_css_rmgr_sp_vbuf_dequeue: 642D */
+/* function ia_css_rmgr_sp_vbuf_dequeue: 6658 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_host2sp_psys_event_queue_handle
@@ -353,11 +355,11 @@ more details.
 #define HIVE_ADDR_sp_xmem_bin_addr 0x436C
 #define HIVE_SIZE_sp_xmem_bin_addr 4
 
-/* function tmr_clock_init: 66F9 */
+/* function tmr_clock_init: 6924 */
 
 /* function ia_css_pipeline_sp_run: 1424 */
 
-/* function memcpy: 6A88 */
+/* function memcpy: 6CB3 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_GP_DEVICE_BASE
@@ -385,13 +387,13 @@ more details.
 
 /* function input_system_reg_store: B18 */
 
-/* function ia_css_isys_sp_frontend_start: 5EA6 */
+/* function ia_css_isys_sp_frontend_start: 60D1 */
 
-/* function ia_css_uds_sp_scale_params: 6791 */
+/* function ia_css_uds_sp_scale_params: 69BC */
 
 /* function ia_css_circbuf_increase_size: E35 */
 
-/* function __divu: 6A06 */
+/* function __divu: 6C31 */
 
 /* function ia_css_thread_sp_get_state: C78 */
 
@@ -423,9 +425,9 @@ more details.
 
 /* function ia_css_parambuf_sp_handle_parameter_sets: 127F */
 
-/* function ia_css_spctrl_sp_set_state: 5A9C */
+/* function ia_css_spctrl_sp_set_state: 5CC7 */
 
-/* function ia_css_thread_sem_sp_signal: 6C8A */
+/* function ia_css_thread_sem_sp_signal: 6EB5 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_IRQ_BASE
@@ -451,13 +453,13 @@ more details.
 #define HIVE_ADDR_sp_TIMED_CTRL_BASE 0x40
 #define HIVE_SIZE_sp_TIMED_CTRL_BASE 4
 
-/* function ia_css_isys_sp_isr: 7157 */
+/* function ia_css_isys_sp_isr: 7382 */
 
-/* function ia_css_isys_sp_generate_exp_id: 623E */
+/* function ia_css_isys_sp_generate_exp_id: 6469 */
 
-/* function ia_css_rmgr_sp_init: 6328 */
+/* function ia_css_rmgr_sp_init: 6553 */
 
-/* function ia_css_thread_sem_sp_init: 6D59 */
+/* function ia_css_thread_sem_sp_init: 6F84 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_reading_cb_frame
@@ -483,15 +485,15 @@ more details.
 #define HIVE_ADDR_sp_is_isp_requested 0x328
 #define HIVE_SIZE_sp_is_isp_requested 4
 
-/* function ia_css_dmaproxy_sp_execute: 33F3 */
+/* function ia_css_dmaproxy_sp_execute: 35EB */
 
-/* function ia_css_queue_is_empty: 70B6 */
+/* function ia_css_queue_is_empty: 72E1 */
 
-/* function ia_css_pipeline_sp_has_stopped: 1844 */
+/* function ia_css_pipeline_sp_has_stopped: 1854 */
 
 /* function ia_css_circbuf_extract: F39 */
 
-/* function ia_css_tagger_buf_sp_is_locked_from_start: 2CAC */
+/* function ia_css_tagger_buf_sp_is_locked_from_start: 2EA4 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_sp_thread
@@ -505,13 +507,13 @@ more details.
 #define HIVE_ADDR_sp_current_sp_thread 0x1DC
 #define HIVE_SIZE_sp_current_sp_thread 4
 
-/* function ia_css_spctrl_sp_get_spid: 5AA3 */
+/* function ia_css_spctrl_sp_get_spid: 5CCE */
 
-/* function ia_css_bufq_sp_reset_buffers: 2EC1 */
+/* function ia_css_bufq_sp_reset_buffers: 30B9 */
 
-/* function ia_css_dmaproxy_sp_read_byte_addr: 6F97 */
+/* function ia_css_dmaproxy_sp_read_byte_addr: 71C2 */
 
-/* function ia_css_rmgr_sp_uninit: 6321 */
+/* function ia_css_rmgr_sp_uninit: 654C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_stack
@@ -529,7 +531,7 @@ more details.
 
 /* function ia_css_parambuf_sp_wait_for_in_param: 1048 */
 
-/* function ia_css_isys_sp_token_map_get_exp_id: 6106 */
+/* function ia_css_isys_sp_token_map_get_exp_id: 6331 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cb_elems_param
@@ -581,7 +583,7 @@ more details.
 #define HIVE_ADDR_sp_sem_for_reading_cb_param 0x48EC
 #define HIVE_SIZE_sp_sem_for_reading_cb_param 40
 
-/* function ia_css_queue_get_used_space: 4C14 */
+/* function ia_css_queue_get_used_space: 4E0C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_cont_capt_start
@@ -607,11 +609,11 @@ more details.
 #define HIVE_ADDR_sp_tmp_heap 0x6200
 #define HIVE_SIZE_sp_tmp_heap 640
 
-/* function ia_css_rmgr_sp_get_num_vbuf: 6631 */
+/* function ia_css_rmgr_sp_get_num_vbuf: 685C */
 
-/* function ia_css_ispctrl_sp_output_compute_dma_info: 418E */
+/* function ia_css_ispctrl_sp_output_compute_dma_info: 4386 */
 
-/* function ia_css_tagger_sp_lock_exp_id: 211A */
+/* function ia_css_tagger_sp_lock_exp_id: 214D */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_s3a_bufs
@@ -625,13 +627,13 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 0x4D7C
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 60
 
-/* function ia_css_queue_is_full: 4CAB */
+/* function ia_css_queue_is_full: 4EA3 */
 
 /* function debug_buffer_init_isp: E4 */
 
-/* function ia_css_isys_sp_frontend_uninit: 5E60 */
+/* function ia_css_isys_sp_frontend_uninit: 608B */
 
-/* function ia_css_tagger_sp_exp_id_is_locked: 2050 */
+/* function ia_css_tagger_sp_exp_id_is_locked: 2068 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_rmgr_sp_mipi_frame_sem
@@ -645,7 +647,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_rmgr_sp_mipi_frame_sem 0x68D4
 #define HIVE_SIZE_sp_ia_css_rmgr_sp_mipi_frame_sem 60
 
-/* function ia_css_rmgr_sp_refcount_dump: 6408 */
+/* function ia_css_rmgr_sp_refcount_dump: 6633 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_isp_parameters_id
@@ -685,7 +687,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_isys_event_queue_handle 0x4DCC
 #define HIVE_SIZE_sp_host2sp_isys_event_queue_handle 12
 
-/* function ia_css_thread_sp_yield: 6C08 */
+/* function ia_css_thread_sp_yield: 6E33 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param_desc
@@ -713,23 +715,23 @@ more details.
 
 /* function ia_css_thread_sp_fork: D05 */
 
-/* function ia_css_tagger_sp_destroy: 2841 */
+/* function ia_css_tagger_sp_destroy: 2970 */
 
-/* function ia_css_dmaproxy_sp_vmem_read: 3393 */
+/* function ia_css_dmaproxy_sp_vmem_read: 358B */
 
-/* function ia_css_ifmtr_sp_init: 628F */
+/* function ia_css_ifmtr_sp_init: 64BA */
 
 /* function initialize_sp_group: 668 */
 
-/* function ia_css_tagger_buf_sp_peek: 2AB8 */
+/* function ia_css_tagger_buf_sp_peek: 2CB0 */
 
 /* function ia_css_thread_sp_init: D31 */
 
-/* function ia_css_isys_sp_reset_exp_id: 6236 */
+/* function ia_css_isys_sp_reset_exp_id: 6461 */
 
-/* function qos_scheduler_update_fps: 6781 */
+/* function qos_scheduler_update_fps: 69AC */
 
-/* function ia_css_ispctrl_sp_set_stream_base_addr: 4882 */
+/* function ia_css_ispctrl_sp_set_stream_base_addr: 4A7A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_DMEM_BASE
@@ -755,9 +757,9 @@ more details.
 #define HIVE_ADDR_sp_SP_DMEM_BASE 0x4
 #define HIVE_SIZE_sp_SP_DMEM_BASE 4
 
-/* function __ia_css_queue_is_empty_text: 4B71 */
+/* function __ia_css_queue_is_empty_text: 4D69 */
 
-/* function ia_css_dmaproxy_sp_read: 3409 */
+/* function ia_css_dmaproxy_sp_read: 3601 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_raw_copy_line_count
@@ -783,7 +785,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_tag_cmd_queue_handle 0x4DD8
 #define HIVE_SIZE_sp_host2sp_tag_cmd_queue_handle 12
 
-/* function ia_css_queue_peek: 4B8A */
+/* function ia_css_queue_peek: 4D82 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_frame_cnt
@@ -823,15 +825,15 @@ more details.
 
 /* function encode_and_post_sp_event_non_blocking: A0C */
 
-/* function ia_css_isys_sp_frontend_destroy: 5F38 */
+/* function ia_css_isys_sp_frontend_destroy: 6163 */
 
 /* function is_ddr_debug_buffer_full: 2CC */
 
-/* function ia_css_isys_sp_frontend_stop: 5E78 */
+/* function ia_css_isys_sp_frontend_stop: 60A3 */
 
-/* function ia_css_isys_sp_token_map_init: 61D4 */
+/* function ia_css_isys_sp_token_map_init: 63FF */
 
-/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 2B08 */
+/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 2D00 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_fiber
@@ -849,9 +851,9 @@ more details.
 
 /* function debug_enqueue_ddr: EE */
 
-/* function ia_css_rmgr_sp_refcount_init_vbuf: 63C3 */
+/* function ia_css_rmgr_sp_refcount_init_vbuf: 65EE */
 
-/* function dmaproxy_sp_read_write: 7035 */
+/* function dmaproxy_sp_read_write: 7260 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_dmaproxy_isp_dma_cmd_buffer
@@ -889,17 +891,17 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_service 0x3278
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_service 4
 
-/* function ia_css_dmaproxy_sp_process: 6D81 */
+/* function ia_css_dmaproxy_sp_process: 6FAC */
 
-/* function ia_css_tagger_buf_sp_mark_from_end: 2D90 */
+/* function ia_css_tagger_buf_sp_mark_from_end: 2F88 */
 
-/* function ia_css_isys_sp_backend_rcv_acquire_ack: 5B45 */
+/* function ia_css_isys_sp_backend_rcv_acquire_ack: 5D70 */
 
-/* function ia_css_isys_sp_backend_pre_acquire_request: 5B5B */
+/* function ia_css_isys_sp_backend_pre_acquire_request: 5D86 */
 
-/* function ia_css_ispctrl_sp_init_cs: 3852 */
+/* function ia_css_ispctrl_sp_init_cs: 3A4A */
 
-/* function ia_css_spctrl_sp_init: 5AB1 */
+/* function ia_css_spctrl_sp_init: 5CDC */
 
 /* function sp_event_proxy_init: 6C4 */
 
@@ -963,11 +965,11 @@ more details.
 #define HIVE_ADDR_sp_INPUT_FORMATTER_BASE 0x4C
 #define HIVE_SIZE_sp_INPUT_FORMATTER_BASE 16
 
-/* function sp_dma_proxy_reset_channels: 3678 */
+/* function sp_dma_proxy_reset_channels: 3870 */
 
-/* function ia_css_isys_sp_backend_acquire: 5C66 */
+/* function ia_css_isys_sp_backend_acquire: 5E91 */
 
-/* function ia_css_tagger_sp_update_size: 2A87 */
+/* function ia_css_tagger_sp_update_size: 2C12 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_host_sp_queue
@@ -983,7 +985,7 @@ more details.
 
 /* function thread_fiber_sp_create: D9D */
 
-/* function ia_css_dmaproxy_sp_set_increments: 350A */
+/* function ia_css_dmaproxy_sp_set_increments: 3702 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_writing_cb_frame
@@ -1019,21 +1021,23 @@ more details.
 #endif
 #define HIVE_ADDR_sp_sp_start_isp_entry 0x453
 
-/* function ia_css_tagger_buf_sp_unmark_all: 2D14 */
+/* function ia_css_tagger_buf_sp_unmark_all: 2F0C */
+
+/* function ia_css_tagger_buf_sp_unmark_from_start: 2F4D */
 
-/* function ia_css_tagger_buf_sp_unmark_from_start: 2D55 */
+/* function ia_css_dmaproxy_sp_channel_acquire: 389C */
 
-/* function ia_css_dmaproxy_sp_channel_acquire: 36A4 */
+/* function ia_css_rmgr_sp_add_num_vbuf: 6838 */
 
-/* function ia_css_rmgr_sp_add_num_vbuf: 660D */
+/* function ia_css_tagger_frame_in_capture_pipe: 2014 */
 
-/* function ia_css_isys_sp_token_map_create: 621D */
+/* function ia_css_isys_sp_token_map_create: 6448 */
 
-/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 335F */
+/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 3557 */
 
-/* function ia_css_tagger_sp_acquire_buf_elem: 2028 */
+/* function ia_css_tagger_sp_acquire_buf_elem: 2040 */
 
-/* function ia_css_bufq_sp_is_dynamic_buffer: 320B */
+/* function ia_css_bufq_sp_is_dynamic_buffer: 3403 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_group
@@ -1061,9 +1065,9 @@ more details.
 
 /* function ia_css_thread_sp_kill: CCB */
 
-/* function ia_css_tagger_sp_create: 2A35 */
+/* function ia_css_tagger_sp_create: 2BC0 */
 
-/* function tmpmem_acquire_dmem: 66BA */
+/* function tmpmem_acquire_dmem: 68E5 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_MMU_BASE
@@ -1077,9 +1081,9 @@ more details.
 #define HIVE_ADDR_sp_MMU_BASE 0x24
 #define HIVE_SIZE_sp_MMU_BASE 8
 
-/* function ia_css_dmaproxy_sp_channel_release: 3690 */
+/* function ia_css_dmaproxy_sp_channel_release: 3888 */
 
-/* function ia_css_dmaproxy_sp_is_idle: 3670 */
+/* function ia_css_dmaproxy_sp_is_idle: 3868 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_qos_start
@@ -1095,9 +1099,9 @@ more details.
 
 /* function isp_hmem_load: B4F */
 
-/* function ia_css_tagger_sp_release_buf_elem: 2004 */
+/* function ia_css_tagger_sp_release_buf_elem: 201C */
 
-/* function ia_css_eventq_sp_send: 36E6 */
+/* function ia_css_eventq_sp_send: 38DE */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_isys_sp_error_cnt
@@ -1111,7 +1115,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_isys_sp_error_cnt 0x64C0
 #define HIVE_SIZE_sp_ia_css_isys_sp_error_cnt 16
 
-/* function ia_css_tagger_buf_sp_unlock_from_start: 2C44 */
+/* function ia_css_tagger_buf_sp_unlock_from_start: 2E3C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_debug_buffer_ddr_address
@@ -1127,35 +1131,35 @@ more details.
 
 /* function sp_isys_copy_request: 6A8 */
 
-/* function ia_css_rmgr_sp_refcount_retain_vbuf: 649D */
+/* function ia_css_rmgr_sp_refcount_retain_vbuf: 66C8 */
 
 /* function ia_css_thread_sp_set_priority: CC3 */
 
 /* function sizeof_hmem: BF6 */
 
-/* function tmpmem_release_dmem: 66A9 */
+/* function tmpmem_release_dmem: 68D4 */
 
 /* function cnd_input_system_cfg: 392 */
 
-/* function __ia_css_sp_rawcopy_func_critical: 70E0 */
+/* function __ia_css_sp_rawcopy_func_critical: 730B */
 
-/* function __ia_css_dmaproxy_sp_process_text: 3303 */
+/* function __ia_css_dmaproxy_sp_process_text: 34FB */
 
-/* function ia_css_dmaproxy_sp_set_width_exception: 34F5 */
+/* function ia_css_dmaproxy_sp_set_width_exception: 36ED */
 
 /* function sp_event_assert: 845 */
 
-/* function ia_css_flash_sp_init_internal_params: 2E2F */
+/* function ia_css_flash_sp_init_internal_params: 3027 */
 
-/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 2B4A */
+/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 2D42 */
 
-/* function __modu: 6A4C */
+/* function __modu: 6C77 */
 
-/* function ia_css_dmaproxy_sp_init_isp_vector: 3365 */
+/* function ia_css_dmaproxy_sp_init_isp_vector: 355D */
 
 /* function isp_vamem_store: 0 */
 
-/* function ia_css_tagger_sp_set_copy_pipe: 2A2C */
+/* function ia_css_tagger_sp_set_copy_pipe: 2BB7 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_GDC_BASE
@@ -1169,11 +1173,11 @@ more details.
 #define HIVE_ADDR_sp_GDC_BASE 0x44
 #define HIVE_SIZE_sp_GDC_BASE 8
 
-/* function ia_css_queue_local_init: 4E75 */
+/* function ia_css_queue_local_init: 506D */
 
-/* function sp_event_proxy_callout_func: 6B19 */
+/* function sp_event_proxy_callout_func: 6D44 */
 
-/* function qos_scheduler_schedule_stage: 672D */
+/* function qos_scheduler_schedule_stage: 6958 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_thread_sp_num_ready_threads
@@ -1199,15 +1203,15 @@ more details.
 #define HIVE_ADDR_sp_sp_threads_stack_size 0x180
 #define HIVE_SIZE_sp_sp_threads_stack_size 28
 
-/* function ia_css_ispctrl_sp_isp_done_row_striping: 4174 */
+/* function ia_css_ispctrl_sp_isp_done_row_striping: 436C */
 
-/* function __ia_css_isys_sp_isr_text: 5F62 */
+/* function __ia_css_isys_sp_isr_text: 618D */
 
-/* function ia_css_queue_dequeue: 4CF3 */
+/* function ia_css_queue_dequeue: 4EEB */
 
-/* function is_qos_standalone_mode: 6708 */
+/* function is_qos_standalone_mode: 6933 */
 
-/* function ia_css_dmaproxy_sp_configure_channel: 6FAE */
+/* function ia_css_dmaproxy_sp_configure_channel: 71D9 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_thread_fiber_sp
@@ -1223,7 +1227,7 @@ more details.
 
 /* function ia_css_circbuf_pop: FCD */
 
-/* function memset: 6ACB */
+/* function memset: 6CF6 */
 
 /* function irq_raise_set_token: B6 */
 
@@ -1239,9 +1243,9 @@ more details.
 #define HIVE_ADDR_sp_GPIO_BASE 0x3C
 #define HIVE_SIZE_sp_GPIO_BASE 4
 
-/* function ia_css_pipeline_acc_stage_enable: 17FD */
+/* function ia_css_pipeline_acc_stage_enable: 180D */
 
-/* function ia_css_tagger_sp_unlock_exp_id: 2075 */
+/* function ia_css_tagger_sp_unlock_exp_id: 208D */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_ph
@@ -1255,11 +1259,11 @@ more details.
 #define HIVE_ADDR_sp_isp_ph 0x64D0
 #define HIVE_SIZE_sp_isp_ph 28
 
-/* function ia_css_isys_sp_token_map_flush: 6162 */
+/* function ia_css_isys_sp_token_map_flush: 638D */
 
-/* function ia_css_ispctrl_sp_init_ds: 39DE */
+/* function ia_css_ispctrl_sp_init_ds: 3BD6 */
 
-/* function get_xmem_base_addr_raw: 3D99 */
+/* function get_xmem_base_addr_raw: 3F91 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param
@@ -1287,23 +1291,23 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp_group 0x497C
 #define HIVE_SIZE_sp_sem_for_sp_group 20
 
-/* function __ia_css_dmaproxy_sp_configure_channel_text: 34D4 */
+/* function __ia_css_dmaproxy_sp_configure_channel_text: 36CC */
 
-/* function ia_css_framebuf_sp_wait_for_in_frame: 6638 */
+/* function ia_css_framebuf_sp_wait_for_in_frame: 6863 */
 
-/* function ia_css_sp_rawcopy_tag_frame: 57CE */
+/* function ia_css_sp_rawcopy_tag_frame: 59ED */
 
 /* function isp_hmem_clear: B1F */
 
-/* function ia_css_framebuf_sp_release_in_frame: 667B */
+/* function ia_css_framebuf_sp_release_in_frame: 68A6 */
 
-/* function ia_css_isys_sp_backend_snd_acquire_request: 5BB8 */
+/* function ia_css_isys_sp_backend_snd_acquire_request: 5DE3 */
 
-/* function ia_css_isys_sp_token_map_is_full: 5FE9 */
+/* function ia_css_isys_sp_token_map_is_full: 6214 */
 
 /* function input_system_acquisition_run: AF3 */
 
-/* function ia_css_ispctrl_sp_start_binary: 3830 */
+/* function ia_css_ispctrl_sp_start_binary: 3A28 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_ddr_ptrs
@@ -1317,7 +1321,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 0x5AE4
 #define HIVE_SIZE_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 20
 
-/* function ia_css_eventq_sp_recv: 36B8 */
+/* function ia_css_eventq_sp_recv: 38B0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_pool
@@ -1331,11 +1335,11 @@ more details.
 #define HIVE_ADDR_sp_isp_pool 0x308
 #define HIVE_SIZE_sp_isp_pool 4
 
-/* function ia_css_rmgr_sp_rel_gen: 636A */
+/* function ia_css_rmgr_sp_rel_gen: 6595 */
 
-/* function ia_css_tagger_sp_unblock_clients: 28FD */
+/* function ia_css_tagger_sp_unblock_clients: 2A2C */
 
-/* function css_get_frame_processing_time_end: 1FF4 */
+/* function css_get_frame_processing_time_end: 2004 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_event_any_pending_mask
@@ -1349,15 +1353,15 @@ more details.
 #define HIVE_ADDR_sp_event_any_pending_mask 0x320
 #define HIVE_SIZE_sp_event_any_pending_mask 8
 
-/* function ia_css_isys_sp_backend_push: 5B6F */
+/* function ia_css_isys_sp_backend_push: 5D9A */
 
 /* function sh_css_decode_tag_descr: 352 */
 
 /* function debug_enqueue_isp: 27B */
 
-/* function qos_scheduler_update_stage_budget: 6710 */
+/* function qos_scheduler_update_stage_budget: 693B */
 
-/* function ia_css_spctrl_sp_uninit: 5AAA */
+/* function ia_css_spctrl_sp_uninit: 5CD5 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SWITCH_CODE
@@ -1383,7 +1387,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_dis_bufs 0x5AF8
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_dis_bufs 140
 
-/* function ia_css_tagger_buf_sp_lock_from_start: 2C78 */
+/* function ia_css_tagger_buf_sp_lock_from_start: 2E70 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_isp_idle
@@ -1397,11 +1401,13 @@ more details.
 #define HIVE_ADDR_sp_sem_for_isp_idle 0x4990
 #define HIVE_SIZE_sp_sem_for_isp_idle 20
 
-/* function ia_css_dmaproxy_sp_write_byte_addr: 33C2 */
+/* function ia_css_dmaproxy_sp_write_byte_addr: 35BA */
+
+/* function ia_css_dmaproxy_sp_init: 3531 */
 
-/* function ia_css_dmaproxy_sp_init: 3339 */
+/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 30F9 */
 
-/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 2F01 */
+/* function ia_css_tagger_buf_sp_set_capture_from_start: 2C43 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_VAMEM_BASE
@@ -1439,11 +1445,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_exp_ids 0x5B84
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_exp_ids 70
 
-/* function ia_css_queue_item_load: 4F67 */
+/* function ia_css_queue_item_load: 515F */
 
-/* function ia_css_spctrl_sp_get_state: 5A95 */
+/* function ia_css_spctrl_sp_get_state: 5CC0 */
 
-/* function ia_css_isys_sp_token_map_uninit: 617F */
+/* function ia_css_isys_sp_token_map_uninit: 63AA */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_callout_sp_thread
@@ -1471,7 +1477,7 @@ more details.
 #define HIVE_ADDR_sp_SP_PMEM_BASE 0x0
 #define HIVE_SIZE_sp_SP_PMEM_BASE 4
 
-/* function ia_css_isys_sp_token_map_snd_acquire_req: 60EF */
+/* function ia_css_isys_sp_token_map_snd_acquire_req: 631A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_isp_input_stream_format
@@ -1485,39 +1491,39 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_input_stream_format 0x4270
 #define HIVE_SIZE_sp_sp_isp_input_stream_format 20
 
-/* function __mod: 6A38 */
+/* function __mod: 6C63 */
 
-/* function ia_css_dmaproxy_sp_init_dmem_channel: 3423 */
+/* function ia_css_dmaproxy_sp_init_dmem_channel: 361B */
 
 /* function ia_css_thread_sp_join: CF4 */
 
-/* function ia_css_dmaproxy_sp_add_command: 70A0 */
+/* function ia_css_dmaproxy_sp_add_command: 72CB */
 
-/* function ia_css_sp_metadata_thread_func: 596D */
+/* function ia_css_sp_metadata_thread_func: 5B98 */
 
-/* function __sp_event_proxy_func_critical: 6B06 */
+/* function __sp_event_proxy_func_critical: 6D31 */
 
-/* function ia_css_sp_metadata_wait: 5A5C */
+/* function ia_css_sp_metadata_wait: 5C87 */
 
 /* function ia_css_circbuf_peek_from_start: EFD */
 
-/* function ia_css_event_sp_encode: 3743 */
+/* function ia_css_event_sp_encode: 393B */
 
 /* function ia_css_thread_sp_run: D67 */
 
 /* function sp_isys_copy_func: 68A */
 
-/* function ia_css_isys_sp_backend_flush: 5BD8 */
+/* function ia_css_isys_sp_backend_flush: 5E03 */
 
-/* function ia_css_isys_sp_backend_frame_exists: 5AF4 */
+/* function ia_css_isys_sp_backend_frame_exists: 5D1F */
 
-/* function ia_css_sp_isp_param_init_isp_memories: 4A1A */
+/* function ia_css_sp_isp_param_init_isp_memories: 4C12 */
 
 /* function register_isr: 83D */
 
 /* function irq_raise: C8 */
 
-/* function ia_css_dmaproxy_sp_mmu_invalidate: 32C9 */
+/* function ia_css_dmaproxy_sp_mmu_invalidate: 34C1 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SRST_ADDRESS
@@ -1531,7 +1537,7 @@ more details.
 #define HIVE_ADDR_sp_HIVE_IF_SRST_ADDRESS 0x1B8
 #define HIVE_SIZE_sp_HIVE_IF_SRST_ADDRESS 16
 
-/* function pipeline_sp_initialize_stage: 1943 */
+/* function pipeline_sp_initialize_stage: 1953 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_isys_sp_frontend_states
@@ -1545,11 +1551,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_isys_sp_frontend_states 0x64B4
 #define HIVE_SIZE_sp_ia_css_isys_sp_frontend_states 12
 
-/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 6F80 */
+/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 71AB */
 
-/* function ia_css_ispctrl_sp_done_ds: 39C5 */
+/* function ia_css_ispctrl_sp_done_ds: 3BBD */
 
-/* function ia_css_sp_isp_param_get_mem_inits: 49F5 */
+/* function ia_css_sp_isp_param_get_mem_inits: 4BED */
 
 /* function ia_css_parambuf_sp_init_buffer_queues: 13F1 */
 
@@ -1591,11 +1597,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_frames 0x5BCC
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_frames 280
 
-/* function qos_scheduler_init_stage_budget: 676E */
+/* function qos_scheduler_init_stage_budget: 6999 */
 
-/* function ia_css_isys_sp_backend_release: 5C4D */
+/* function ia_css_isys_sp_backend_release: 5E78 */
 
-/* function ia_css_isys_sp_backend_destroy: 5C77 */
+/* function ia_css_isys_sp_backend_destroy: 5EA2 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_buffer_queue_handle
@@ -1609,19 +1615,19 @@ more details.
 #define HIVE_ADDR_sp_sp2host_buffer_queue_handle 0x5CE4
 #define HIVE_SIZE_sp_sp2host_buffer_queue_handle 96
 
-/* function ia_css_isys_sp_token_map_check_mipi_frame_size: 60B3 */
+/* function ia_css_isys_sp_token_map_check_mipi_frame_size: 62DE */
 
-/* function ia_css_ispctrl_sp_init_isp_vars: 46E7 */
+/* function ia_css_ispctrl_sp_init_isp_vars: 48DF */
 
-/* function ia_css_isys_sp_frontend_has_empty_mipi_buffer_cb: 5CC9 */
+/* function ia_css_isys_sp_frontend_has_empty_mipi_buffer_cb: 5EF4 */
 
 /* function sp_warning: 870 */
 
-/* function ia_css_rmgr_sp_vbuf_enqueue: 645D */
+/* function ia_css_rmgr_sp_vbuf_enqueue: 6688 */
 
-/* function ia_css_tagger_sp_tag_exp_id: 218F */
+/* function ia_css_tagger_sp_tag_exp_id: 21C2 */
 
-/* function ia_css_dmaproxy_sp_write: 33D9 */
+/* function ia_css_dmaproxy_sp_write: 35D1 */
 
 /* function ia_css_parambuf_sp_release_in_param: 1245 */
 
@@ -1649,7 +1655,7 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_addresses 0x6134
 #define HIVE_SIZE_sp_sp_isp_addresses 172
 
-/* function ia_css_rmgr_sp_acq_gen: 6382 */
+/* function ia_css_rmgr_sp_acq_gen: 65AD */
 
 /* function receiver_reg_load: ACA */
 
@@ -1677,7 +1683,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_queues_initialized 0x4284
 #define HIVE_SIZE_sp_host_sp_queues_initialized 4
 
-/* function ia_css_queue_uninit: 4E33 */
+/* function ia_css_queue_uninit: 502B */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_ispctrl_sp_isp_started
@@ -1691,13 +1697,13 @@ more details.
 #define HIVE_ADDR_sp_ia_css_ispctrl_sp_isp_started 0x5DEC
 #define HIVE_SIZE_sp_ia_css_ispctrl_sp_isp_started 4
 
-/* function ia_css_bufq_sp_release_dynamic_buf: 2F6D */
+/* function ia_css_bufq_sp_release_dynamic_buf: 3165 */
 
-/* function ia_css_dmaproxy_sp_set_height_exception: 34E6 */
+/* function ia_css_dmaproxy_sp_set_height_exception: 36DE */
 
-/* function ia_css_dmaproxy_sp_init_vmem_channel: 3457 */
+/* function ia_css_dmaproxy_sp_init_vmem_channel: 364F */
 
-/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 33AB */
+/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 35A3 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_vbuf_spref
@@ -1723,7 +1729,7 @@ more details.
 #define HIVE_ADDR_sp_sp_metadata_thread 0x4B8C
 #define HIVE_SIZE_sp_sp_metadata_thread 72
 
-/* function ia_css_queue_enqueue: 4D7D */
+/* function ia_css_queue_enqueue: 4F75 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_request
@@ -1737,7 +1743,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_request 0x4C88
 #define HIVE_SIZE_sp_ia_css_flash_sp_request 4
 
-/* function ia_css_dmaproxy_sp_vmem_write: 337C */
+/* function ia_css_dmaproxy_sp_vmem_write: 3574 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_tagger_frames
@@ -1751,7 +1757,7 @@ more details.
 #define HIVE_ADDR_sp_tagger_frames 0x4BDC
 #define HIVE_SIZE_sp_tagger_frames 168
 
-/* function ia_css_isys_sp_token_map_snd_capture_req: 6111 */
+/* function ia_css_isys_sp_token_map_snd_capture_req: 633C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_reading_if
@@ -1767,13 +1773,13 @@ more details.
 
 /* function sp_generate_interrupts: 8EF */
 
-/* function ia_css_pipeline_sp_start: 1856 */
+/* function ia_css_pipeline_sp_start: 1866 */
 
-/* function ia_css_thread_default_callout: 6C01 */
+/* function ia_css_thread_default_callout: 6E2C */
 
-/* function ia_css_sp_rawcopy_init: 536F */
+/* function ia_css_sp_rawcopy_init: 5567 */
 
-/* function tmr_clock_read: 66EF */
+/* function tmr_clock_read: 691A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_BAMEM_BASE
@@ -1787,7 +1793,7 @@ more details.
 #define HIVE_ADDR_sp_ISP_BAMEM_BASE 0x318
 #define HIVE_SIZE_sp_ISP_BAMEM_BASE 4
 
-/* function ia_css_isys_sp_frontend_rcv_capture_ack: 5D78 */
+/* function ia_css_isys_sp_frontend_rcv_capture_ack: 5FA3 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_sems_for_sp2host_buf_queues
@@ -1801,7 +1807,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_sems_for_sp2host_buf_queues 0x5D44
 #define HIVE_SIZE_sp_ia_css_bufq_sp_sems_for_sp2host_buf_queues 160
 
-/* function css_get_frame_processing_time_start: 1FFC */
+/* function css_get_frame_processing_time_start: 200C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_frame
@@ -1831,9 +1837,9 @@ more details.
 #define HIVE_ADDR_sp_sem_for_str2mem 0x49C8
 #define HIVE_SIZE_sp_sem_for_str2mem 20
 
-/* function ia_css_tagger_buf_sp_is_marked_from_start: 2CE0 */
+/* function ia_css_tagger_buf_sp_is_marked_from_start: 2ED8 */
 
-/* function ia_css_bufq_sp_acquire_dynamic_buf: 3125 */
+/* function ia_css_bufq_sp_acquire_dynamic_buf: 331D */
 
 /* function ia_css_circbuf_destroy: 1012 */
 
@@ -1849,15 +1855,15 @@ more details.
 #define HIVE_ADDR_sp_ISP_PMEM_BASE 0xC
 #define HIVE_SIZE_sp_ISP_PMEM_BASE 4
 
-/* function ia_css_sp_isp_param_mem_load: 4988 */
+/* function ia_css_sp_isp_param_mem_load: 4B80 */
 
-/* function ia_css_tagger_buf_sp_pop_from_start: 2ACC */
+/* function ia_css_tagger_buf_sp_pop_from_start: 2CC4 */
 
-/* function __div: 69F0 */
+/* function __div: 6C1B */
 
-/* function ia_css_isys_sp_frontend_create: 5F49 */
+/* function ia_css_isys_sp_frontend_create: 6174 */
 
-/* function ia_css_rmgr_sp_refcount_release_vbuf: 647C */
+/* function ia_css_rmgr_sp_refcount_release_vbuf: 66A7 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_in_use
@@ -1871,7 +1877,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_use 0x4C8C
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_use 4
 
-/* function ia_css_thread_sem_sp_wait: 6CD5 */
+/* function ia_css_thread_sem_sp_wait: 6F00 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_sleep_mode
@@ -1885,7 +1891,7 @@ more details.
 #define HIVE_ADDR_sp_sp_sleep_mode 0x4288
 #define HIVE_SIZE_sp_sp_sleep_mode 4
 
-/* function ia_css_tagger_buf_sp_push: 2BDB */
+/* function ia_css_tagger_buf_sp_push: 2DD3 */
 
 /* function mmu_invalidate_cache: D3 */
 
@@ -1901,7 +1907,7 @@ more details.
 #define HIVE_ADDR_sp_sp_max_cb_elems 0x148
 #define HIVE_SIZE_sp_sp_max_cb_elems 8
 
-/* function ia_css_queue_remote_init: 4E55 */
+/* function ia_css_queue_remote_init: 504D */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_stop_req
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.c
index 5e293e8..70bf169 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.c
@@ -396,6 +396,56 @@ size);
 /* Code generated by genparam/gencode.c:gen_process_function() */
 
 static void
+ia_css_process_bnlm(
+	unsigned pipe_id,
+	const struct ia_css_pipeline_stage *stage,
+	struct ia_css_isp_parameters *params)
+{
+	assert(params != NULL);
+
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_encode((struct bnlm_dmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_DMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_DMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_vmem_encode((struct bnlm_vmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_VMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_VMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+}
+
+/* Code generated by genparam/gencode.c:gen_process_function() */
+
+static void
 ia_css_process_eed1_8(
 	unsigned pipe_id,
 	const struct ia_css_pipeline_stage *stage,
@@ -1913,6 +1963,7 @@ void (* ia_css_kernel_process_param[IA_CSS_NUM_PARAMETER_IDS])(
 	ia_css_process_dp,
 	ia_css_process_bnr,
 	ia_css_process_dpc2,
+	ia_css_process_bnlm,
 	ia_css_process_eed1_8,
 	ia_css_process_de,
 	ia_css_process_ecd,
@@ -2033,6 +2084,42 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_get_function() */
 
 static void
+ia_css_get_bnlm_config(const struct ia_css_isp_parameters *params,
+			struct ia_css_bnlm_config *config){
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() enter: "
+		"config=%p\n",config);
+
+	*config = params->bnlm_config;
+
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() leave\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+}
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config)
+{
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "ia_css_set_bnlm_config() enter:\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+	params->bnlm_config = *config;
+	params->config_changed[IA_CSS_BNLM_ID] = true;
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_set_bnlm_config() leave: "
+		"return_void\n");
+}
+
+/* Code generated by genparam/gencode.c:gen_get_function() */
+
+static void
 ia_css_get_eed1_8_config(const struct ia_css_isp_parameters *params,
 			struct ia_css_eed1_8_config *config){
 	if (config == NULL)
@@ -3576,6 +3663,7 @@ ia_css_get_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_get_dp_config(params, config->dp_config);
 	ia_css_get_dpc2_config(params, config->dpc2_config);
+	ia_css_get_bnlm_config(params, config->bnlm_config);
 	ia_css_get_eed1_8_config(params, config->eed1_8_config);
 	ia_css_get_wb_config(params, config->wb_config);
 	ia_css_get_tnr_config(params, config->tnr_config);
@@ -3628,6 +3716,7 @@ ia_css_set_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_set_dp_config(params, config->dp_config);
 	ia_css_set_dpc2_config(params, config->dpc2_config);
+	ia_css_set_bnlm_config(params, config->bnlm_config);
 	ia_css_set_eed1_8_config(params, config->eed1_8_config);
 	ia_css_set_wb_config(params, config->wb_config);
 	ia_css_set_tnr_config(params, config->tnr_config);
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.h
index 3acdc0c..2b971c8 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/hive_isp_css_2401_system_csi2p_generated/ia_css_isp_params.h
@@ -29,6 +29,7 @@ enum ia_css_parameter_ids {
 	IA_CSS_DP_ID,
 	IA_CSS_BNR_ID,
 	IA_CSS_DPC2_ID,
+	IA_CSS_BNLM_ID,
 	IA_CSS_EED1_8_ID,
 	IA_CSS_DE_ID,
 	IA_CSS_ECD_ID,
@@ -88,6 +89,7 @@ struct ia_css_memory_offsets {
 		struct ia_css_isp_parameter dp;
 		struct ia_css_isp_parameter bnr;
 		struct ia_css_isp_parameter dpc2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter de;
 		struct ia_css_isp_parameter ecd;
@@ -129,6 +131,7 @@ struct ia_css_memory_offsets {
 	} dmem;
 	struct {
 		struct ia_css_isp_parameter anr2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter ob;
 		struct ia_css_isp_parameter macc1_5;
@@ -186,6 +189,12 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_set_function() */
 
 void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config);
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
 ia_css_set_eed1_8_config(struct ia_css_isp_parameters *params,
 			const struct ia_css_eed1_8_config *config);
 
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/spmem_dump.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/spmem_dump.c
index e775642..554da12 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/spmem_dump.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_csi2p_system/spmem_dump.c
@@ -21,11 +21,11 @@ more details.
 
 #define _hrt_cell_load_program_sp(proc) _hrt_cell_load_program_embedded(proc, sp)
 
-/* function longjmp: 6A2D */
+/* function longjmp: 6C56 */
 
-/* function tmpmem_init_dmem: 6740 */
+/* function tmpmem_init_dmem: 6969 */
 
-/* function ia_css_dmaproxy_sp_set_addr_B: 3DC5 */
+/* function ia_css_dmaproxy_sp_set_addr_B: 3FBD */
 
 /* function ia_css_pipe_data_init_tagger_resources: AC7 */
 
@@ -43,15 +43,15 @@ more details.
 #define HIVE_ADDR_sp_vbuf_mipi 0x744C
 #define HIVE_SIZE_sp_vbuf_mipi 12
 
-/* function ia_css_event_sp_decode: 3FB6 */
+/* function ia_css_event_sp_decode: 41AE */
 
-/* function ia_css_queue_get_size: 53D6 */
+/* function ia_css_queue_get_size: 55CE */
 
-/* function ia_css_queue_load: 59ED */
+/* function ia_css_queue_load: 5BE5 */
 
-/* function setjmp: 6A36 */
+/* function setjmp: 6C5F */
 
-/* function ia_css_pipeline_sp_sfi_get_current_frame: 2790 */
+/* function ia_css_pipeline_sp_sfi_get_current_frame: 27A0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_sp2host_isys_event_queue
@@ -65,11 +65,11 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_isys_event_queue 0x5804
 #define HIVE_SIZE_sp_sem_for_sp2host_isys_event_queue 20
 
-/* function ia_css_dmaproxy_sp_wait_for_ack: 7019 */
+/* function ia_css_dmaproxy_sp_wait_for_ack: 7242 */
 
-/* function ia_css_sp_rawcopy_func: 5B6C */
+/* function ia_css_sp_rawcopy_func: 5D64 */
 
-/* function ia_css_tagger_buf_sp_pop_marked: 345C */
+/* function ia_css_tagger_buf_sp_pop_marked: 3654 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_N_CSI_RX_BE_SID_WIDTH
@@ -107,9 +107,9 @@ more details.
 #define HIVE_ADDR_sp_vbuf_raw 0x39C
 #define HIVE_SIZE_sp_vbuf_raw 4
 
-/* function ia_css_sp_bin_copy_func: 5B4D */
+/* function ia_css_sp_bin_copy_func: 5D45 */
 
-/* function ia_css_queue_item_store: 573B */
+/* function ia_css_queue_item_store: 5933 */
 
 /* function input_system_reset: 1201 */
 
@@ -165,7 +165,7 @@ more details.
 
 /* function ia_css_thread_sp_main: 136D */
 
-/* function ia_css_ispctrl_sp_init_internal_buffers: 41F7 */
+/* function ia_css_ispctrl_sp_init_internal_buffers: 43EF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_psys_event_queue_handle
@@ -193,7 +193,9 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_psys_event_queue 0x5818
 #define HIVE_SIZE_sp_sem_for_sp2host_psys_event_queue 20
 
-/* function ia_css_tagger_sp_propagate_frame: 2D23 */
+/* function ia_css_tagger_buf_sp_get_capture_from_start: 3542 */
+
+/* function ia_css_tagger_sp_propagate_frame: 2D56 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_vbuf_handles
@@ -207,15 +209,15 @@ more details.
 #define HIVE_ADDR_sp_vbuf_handles 0x7458
 #define HIVE_SIZE_sp_vbuf_handles 960
 
-/* function ia_css_queue_store: 58A1 */
+/* function ia_css_queue_store: 5A99 */
 
-/* function ia_css_sp_flash_register: 3691 */
+/* function ia_css_sp_flash_register: 3889 */
 
-/* function ia_css_pipeline_sp_init: 1FD7 */
+/* function ia_css_pipeline_sp_init: 1FE7 */
 
-/* function ia_css_tagger_sp_configure: 2C13 */
+/* function ia_css_tagger_sp_configure: 2C46 */
 
-/* function ia_css_ispctrl_sp_end_binary: 3FFF */
+/* function ia_css_ispctrl_sp_end_binary: 41F7 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_per_frame_ddr_ptrs
@@ -279,7 +281,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_com 0x3E74
 #define HIVE_SIZE_sp_host_sp_com 220
 
-/* function ia_css_queue_get_free_space: 5500 */
+/* function ia_css_queue_get_free_space: 56F8 */
 
 /* function exec_image_pipe: 57A */
 
@@ -295,19 +297,19 @@ more details.
 #define HIVE_ADDR_sp_sp_init_dmem_data 0x73FC
 #define HIVE_SIZE_sp_sp_init_dmem_data 24
 
-/* function ia_css_sp_metadata_start: 5ED5 */
+/* function ia_css_sp_metadata_start: 60FE */
 
-/* function ia_css_bufq_sp_init_buffer_queues: 36E2 */
+/* function ia_css_bufq_sp_init_buffer_queues: 38DA */
 
-/* function ia_css_pipeline_sp_stop: 1FBA */
+/* function ia_css_pipeline_sp_stop: 1FCA */
 
-/* function ia_css_tagger_sp_connect_pipes: 30FD */
+/* function ia_css_tagger_sp_connect_pipes: 322C */
 
 /* function sp_isys_copy_wait: 5D8 */
 
 /* function is_isp_debug_buffer_full: 337 */
 
-/* function ia_css_dmaproxy_sp_configure_channel_from_info: 3D35 */
+/* function ia_css_dmaproxy_sp_configure_channel_from_info: 3F2D */
 
 /* function encode_and_post_timer_event: A3C */
 
@@ -347,7 +349,7 @@ more details.
 #define HIVE_ADDR_sp_sp_per_frame_data 0x3F50
 #define HIVE_SIZE_sp_sp_per_frame_data 4
 
-/* function ia_css_rmgr_sp_vbuf_dequeue: 6494 */
+/* function ia_css_rmgr_sp_vbuf_dequeue: 66BD */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_host2sp_psys_event_queue_handle
@@ -377,7 +379,7 @@ more details.
 
 /* function ia_css_pipeline_sp_run: 1A61 */
 
-/* function memcpy: 6AD6 */
+/* function memcpy: 6CFF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_N_ISYS2401_DMA_CHANNEL_PROCS
@@ -417,11 +419,11 @@ more details.
 
 /* function stream2mmio_send_command: E04 */
 
-/* function ia_css_uds_sp_scale_params: 67DF */
+/* function ia_css_uds_sp_scale_params: 6A08 */
 
 /* function ia_css_circbuf_increase_size: 1452 */
 
-/* function __divu: 6A54 */
+/* function __divu: 6C7D */
 
 /* function ia_css_thread_sp_get_state: 1295 */
 
@@ -465,9 +467,9 @@ more details.
 
 /* function ia_css_parambuf_sp_handle_parameter_sets: 18B5 */
 
-/* function ia_css_spctrl_sp_set_state: 5EF1 */
+/* function ia_css_spctrl_sp_set_state: 611A */
 
-/* function ia_css_thread_sem_sp_signal: 6D3A */
+/* function ia_css_thread_sem_sp_signal: 6F63 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_IRQ_BASE
@@ -481,7 +483,7 @@ more details.
 #define HIVE_ADDR_sp_IRQ_BASE 0x2C
 #define HIVE_SIZE_sp_IRQ_BASE 16
 
-/* function ia_css_virtual_isys_sp_isr_init: 5F92 */
+/* function ia_css_virtual_isys_sp_isr_init: 61BB */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_TIMED_CTRL_BASE
@@ -495,11 +497,11 @@ more details.
 #define HIVE_ADDR_sp_TIMED_CTRL_BASE 0x40
 #define HIVE_SIZE_sp_TIMED_CTRL_BASE 4
 
-/* function ia_css_isys_sp_generate_exp_id: 6324 */
+/* function ia_css_isys_sp_generate_exp_id: 654D */
 
-/* function ia_css_rmgr_sp_init: 638F */
+/* function ia_css_rmgr_sp_init: 65B8 */
 
-/* function ia_css_thread_sem_sp_init: 6E09 */
+/* function ia_css_thread_sem_sp_init: 7032 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_reading_cb_frame
@@ -525,17 +527,17 @@ more details.
 #define HIVE_ADDR_sp_is_isp_requested 0x3B0
 #define HIVE_SIZE_sp_is_isp_requested 4
 
-/* function ia_css_dmaproxy_sp_execute: 3C9B */
+/* function ia_css_dmaproxy_sp_execute: 3E93 */
 
 /* function csi_rx_backend_rst: CE0 */
 
-/* function ia_css_queue_is_empty: 7166 */
+/* function ia_css_queue_is_empty: 738F */
 
-/* function ia_css_pipeline_sp_has_stopped: 1FB0 */
+/* function ia_css_pipeline_sp_has_stopped: 1FC0 */
 
 /* function ia_css_circbuf_extract: 1556 */
 
-/* function ia_css_tagger_buf_sp_is_locked_from_start: 3572 */
+/* function ia_css_tagger_buf_sp_is_locked_from_start: 376A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_sp_thread
@@ -549,13 +551,13 @@ more details.
 #define HIVE_ADDR_sp_current_sp_thread 0x274
 #define HIVE_SIZE_sp_current_sp_thread 4
 
-/* function ia_css_spctrl_sp_get_spid: 5EF8 */
+/* function ia_css_spctrl_sp_get_spid: 6121 */
 
-/* function ia_css_bufq_sp_reset_buffers: 3769 */
+/* function ia_css_bufq_sp_reset_buffers: 3961 */
 
-/* function ia_css_dmaproxy_sp_read_byte_addr: 7047 */
+/* function ia_css_dmaproxy_sp_read_byte_addr: 7270 */
 
-/* function ia_css_rmgr_sp_uninit: 6388 */
+/* function ia_css_rmgr_sp_uninit: 65B1 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_stack
@@ -635,7 +637,7 @@ more details.
 #define HIVE_ADDR_sp_sem_for_reading_cb_param 0x5890
 #define HIVE_SIZE_sp_sem_for_reading_cb_param 40
 
-/* function ia_css_queue_get_used_space: 54B4 */
+/* function ia_css_queue_get_used_space: 56AC */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_cont_capt_start
@@ -661,11 +663,11 @@ more details.
 #define HIVE_ADDR_sp_tmp_heap 0x7160
 #define HIVE_SIZE_sp_tmp_heap 640
 
-/* function ia_css_rmgr_sp_get_num_vbuf: 6698 */
+/* function ia_css_rmgr_sp_get_num_vbuf: 68C1 */
 
-/* function ia_css_ispctrl_sp_output_compute_dma_info: 4A2E */
+/* function ia_css_ispctrl_sp_output_compute_dma_info: 4C26 */
 
-/* function ia_css_tagger_sp_lock_exp_id: 29E0 */
+/* function ia_css_tagger_sp_lock_exp_id: 2A13 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_s3a_bufs
@@ -679,11 +681,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 0x5CD8
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 60
 
-/* function ia_css_queue_is_full: 554B */
+/* function ia_css_queue_is_full: 5743 */
 
 /* function debug_buffer_init_isp: E4 */
 
-/* function ia_css_tagger_sp_exp_id_is_locked: 2916 */
+/* function ia_css_tagger_sp_exp_id_is_locked: 292E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_rmgr_sp_mipi_frame_sem
@@ -697,7 +699,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_rmgr_sp_mipi_frame_sem 0x7818
 #define HIVE_SIZE_sp_ia_css_rmgr_sp_mipi_frame_sem 60
 
-/* function ia_css_rmgr_sp_refcount_dump: 646F */
+/* function ia_css_rmgr_sp_refcount_dump: 6698 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_isp_parameters_id
@@ -739,7 +741,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_isys_event_queue_handle 0x5D28
 #define HIVE_SIZE_sp_host2sp_isys_event_queue_handle 12
 
-/* function ia_css_thread_sp_yield: 6CB8 */
+/* function ia_css_thread_sp_yield: 6EE1 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param_desc
@@ -767,9 +769,9 @@ more details.
 
 /* function ia_css_thread_sp_fork: 1322 */
 
-/* function ia_css_tagger_sp_destroy: 3107 */
+/* function ia_css_tagger_sp_destroy: 3236 */
 
-/* function ia_css_dmaproxy_sp_vmem_read: 3C3B */
+/* function ia_css_dmaproxy_sp_vmem_read: 3E33 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_N_LONG_PACKET_LUT_ENTRIES
@@ -785,15 +787,15 @@ more details.
 
 /* function initialize_sp_group: 58A */
 
-/* function ia_css_tagger_buf_sp_peek: 337E */
+/* function ia_css_tagger_buf_sp_peek: 3576 */
 
 /* function ia_css_thread_sp_init: 134E */
 
-/* function qos_scheduler_update_fps: 67CF */
+/* function qos_scheduler_update_fps: 69F8 */
 
-/* function ia_css_isys_sp_reset_exp_id: 631B */
+/* function ia_css_isys_sp_reset_exp_id: 6544 */
 
-/* function ia_css_ispctrl_sp_set_stream_base_addr: 5122 */
+/* function ia_css_ispctrl_sp_set_stream_base_addr: 531A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_DMEM_BASE
@@ -821,11 +823,11 @@ more details.
 
 /* function ibuf_ctrl_transfer: D61 */
 
-/* function __ia_css_queue_is_empty_text: 5411 */
+/* function __ia_css_queue_is_empty_text: 5609 */
 
-/* function ia_css_dmaproxy_sp_read: 3CB1 */
+/* function ia_css_dmaproxy_sp_read: 3EA9 */
 
-/* function virtual_isys_stream_is_capture_done: 5FB6 */
+/* function virtual_isys_stream_is_capture_done: 61DF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_raw_copy_line_count
@@ -851,7 +853,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_tag_cmd_queue_handle 0x5D34
 #define HIVE_SIZE_sp_host2sp_tag_cmd_queue_handle 12
 
-/* function ia_css_queue_peek: 542A */
+/* function ia_css_queue_peek: 5622 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_frame_cnt
@@ -895,7 +897,7 @@ more details.
 
 /* function is_ddr_debug_buffer_full: 2CC */
 
-/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 33CE */
+/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 35C6 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_fiber
@@ -913,9 +915,9 @@ more details.
 
 /* function debug_enqueue_ddr: EE */
 
-/* function ia_css_rmgr_sp_refcount_init_vbuf: 642A */
+/* function ia_css_rmgr_sp_refcount_init_vbuf: 6653 */
 
-/* function dmaproxy_sp_read_write: 70E5 */
+/* function dmaproxy_sp_read_write: 730E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_dmaproxy_isp_dma_cmd_buffer
@@ -953,13 +955,13 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_service 0x307C
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_service 4
 
-/* function ia_css_dmaproxy_sp_process: 6E31 */
+/* function ia_css_dmaproxy_sp_process: 705A */
 
-/* function ia_css_tagger_buf_sp_mark_from_end: 3656 */
+/* function ia_css_tagger_buf_sp_mark_from_end: 384E */
 
-/* function ia_css_ispctrl_sp_init_cs: 40FA */
+/* function ia_css_ispctrl_sp_init_cs: 42F2 */
 
-/* function ia_css_spctrl_sp_init: 5F06 */
+/* function ia_css_spctrl_sp_init: 612F */
 
 /* function sp_event_proxy_init: 736 */
 
@@ -1027,9 +1029,9 @@ more details.
 #define HIVE_ADDR_sp_INPUT_FORMATTER_BASE 0x4C
 #define HIVE_SIZE_sp_INPUT_FORMATTER_BASE 16
 
-/* function sp_dma_proxy_reset_channels: 3F20 */
+/* function sp_dma_proxy_reset_channels: 4118 */
 
-/* function ia_css_tagger_sp_update_size: 334D */
+/* function ia_css_tagger_sp_update_size: 34D8 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_host_sp_queue
@@ -1045,7 +1047,7 @@ more details.
 
 /* function thread_fiber_sp_create: 13BA */
 
-/* function ia_css_dmaproxy_sp_set_increments: 3DB2 */
+/* function ia_css_dmaproxy_sp_set_increments: 3FAA */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_writing_cb_frame
@@ -1073,7 +1075,7 @@ more details.
 
 /* function pixelgen_tpg_is_done: F07 */
 
-/* function ia_css_isys_stream_capture_indication: 60F9 */
+/* function ia_css_isys_stream_capture_indication: 6322 */
 
 /* function sp_start_isp_entry: 392 */
 #ifndef HIVE_MULTIPLE_PROGRAMS
@@ -1083,23 +1085,25 @@ more details.
 #endif
 #define HIVE_ADDR_sp_sp_start_isp_entry 0x392
 
-/* function ia_css_tagger_buf_sp_unmark_all: 35DA */
+/* function ia_css_tagger_buf_sp_unmark_all: 37D2 */
+
+/* function ia_css_tagger_buf_sp_unmark_from_start: 3813 */
 
-/* function ia_css_tagger_buf_sp_unmark_from_start: 361B */
+/* function ia_css_dmaproxy_sp_channel_acquire: 4144 */
 
-/* function ia_css_dmaproxy_sp_channel_acquire: 3F4C */
+/* function ia_css_rmgr_sp_add_num_vbuf: 689D */
 
-/* function ia_css_rmgr_sp_add_num_vbuf: 6674 */
+/* function ia_css_tagger_frame_in_capture_pipe: 28DA */
 
 /* function ibuf_ctrl_config: D85 */
 
-/* function ia_css_isys_stream_stop: 6216 */
+/* function ia_css_isys_stream_stop: 643F */
 
-/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 3C07 */
+/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 3DFF */
 
-/* function ia_css_tagger_sp_acquire_buf_elem: 28EE */
+/* function ia_css_tagger_sp_acquire_buf_elem: 2906 */
 
-/* function ia_css_bufq_sp_is_dynamic_buffer: 3AB3 */
+/* function ia_css_bufq_sp_is_dynamic_buffer: 3CAB */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_group
@@ -1127,9 +1131,9 @@ more details.
 
 /* function ia_css_thread_sp_kill: 12E8 */
 
-/* function ia_css_tagger_sp_create: 32FB */
+/* function ia_css_tagger_sp_create: 3486 */
 
-/* function tmpmem_acquire_dmem: 6721 */
+/* function tmpmem_acquire_dmem: 694A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_MMU_BASE
@@ -1143,11 +1147,11 @@ more details.
 #define HIVE_ADDR_sp_MMU_BASE 0x24
 #define HIVE_SIZE_sp_MMU_BASE 8
 
-/* function ia_css_dmaproxy_sp_channel_release: 3F38 */
+/* function ia_css_dmaproxy_sp_channel_release: 4130 */
 
 /* function pixelgen_prbs_run: E7B */
 
-/* function ia_css_dmaproxy_sp_is_idle: 3F18 */
+/* function ia_css_dmaproxy_sp_is_idle: 4110 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_qos_start
@@ -1163,11 +1167,11 @@ more details.
 
 /* function isp_hmem_load: B5D */
 
-/* function ia_css_tagger_sp_release_buf_elem: 28CA */
+/* function ia_css_tagger_sp_release_buf_elem: 28E2 */
 
-/* function ia_css_eventq_sp_send: 3F8E */
+/* function ia_css_eventq_sp_send: 4186 */
 
-/* function ia_css_tagger_buf_sp_unlock_from_start: 350A */
+/* function ia_css_tagger_buf_sp_unlock_from_start: 3702 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_debug_buffer_ddr_address
@@ -1183,7 +1187,7 @@ more details.
 
 /* function sp_isys_copy_request: 681 */
 
-/* function ia_css_rmgr_sp_refcount_retain_vbuf: 6504 */
+/* function ia_css_rmgr_sp_refcount_retain_vbuf: 672D */
 
 /* function ia_css_thread_sp_set_priority: 12E0 */
 
@@ -1193,27 +1197,27 @@ more details.
 
 /* function pixelgen_tpg_stop: EF5 */
 
-/* function tmpmem_release_dmem: 6710 */
+/* function tmpmem_release_dmem: 6939 */
 
-/* function __ia_css_dmaproxy_sp_process_text: 3BAB */
+/* function __ia_css_dmaproxy_sp_process_text: 3DA3 */
 
-/* function ia_css_dmaproxy_sp_set_width_exception: 3D9D */
+/* function ia_css_dmaproxy_sp_set_width_exception: 3F95 */
 
 /* function sp_event_assert: 8BD */
 
-/* function ia_css_flash_sp_init_internal_params: 36D7 */
+/* function ia_css_flash_sp_init_internal_params: 38CF */
 
-/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 3410 */
+/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 3608 */
 
-/* function __modu: 6A9A */
+/* function __modu: 6CC3 */
 
-/* function ia_css_dmaproxy_sp_init_isp_vector: 3C0D */
+/* function ia_css_dmaproxy_sp_init_isp_vector: 3E05 */
 
 /* function input_system_channel_transfer: 11A5 */
 
 /* function isp_vamem_store: 0 */
 
-/* function ia_css_tagger_sp_set_copy_pipe: 32F2 */
+/* function ia_css_tagger_sp_set_copy_pipe: 347D */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_GDC_BASE
@@ -1227,11 +1231,11 @@ more details.
 #define HIVE_ADDR_sp_GDC_BASE 0x44
 #define HIVE_SIZE_sp_GDC_BASE 8
 
-/* function ia_css_queue_local_init: 5715 */
+/* function ia_css_queue_local_init: 590D */
 
-/* function sp_event_proxy_callout_func: 6B67 */
+/* function sp_event_proxy_callout_func: 6D90 */
 
-/* function qos_scheduler_schedule_stage: 677B */
+/* function qos_scheduler_schedule_stage: 69A4 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_thread_sp_num_ready_threads
@@ -1257,15 +1261,15 @@ more details.
 #define HIVE_ADDR_sp_sp_threads_stack_size 0x17C
 #define HIVE_SIZE_sp_sp_threads_stack_size 24
 
-/* function ia_css_ispctrl_sp_isp_done_row_striping: 4A14 */
+/* function ia_css_ispctrl_sp_isp_done_row_striping: 4C0C */
 
-/* function __ia_css_virtual_isys_sp_isr_text: 5F70 */
+/* function __ia_css_virtual_isys_sp_isr_text: 6199 */
 
-/* function ia_css_queue_dequeue: 5593 */
+/* function ia_css_queue_dequeue: 578B */
 
-/* function is_qos_standalone_mode: 6756 */
+/* function is_qos_standalone_mode: 697F */
 
-/* function ia_css_dmaproxy_sp_configure_channel: 705E */
+/* function ia_css_dmaproxy_sp_configure_channel: 7287 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_thread_fiber_sp
@@ -1281,7 +1285,7 @@ more details.
 
 /* function ia_css_circbuf_pop: 15EA */
 
-/* function memset: 6B19 */
+/* function memset: 6D42 */
 
 /* function irq_raise_set_token: B6 */
 
@@ -1299,9 +1303,9 @@ more details.
 
 /* function pixelgen_prbs_stop: E69 */
 
-/* function ia_css_pipeline_acc_stage_enable: 1F69 */
+/* function ia_css_pipeline_acc_stage_enable: 1F79 */
 
-/* function ia_css_tagger_sp_unlock_exp_id: 293B */
+/* function ia_css_tagger_sp_unlock_exp_id: 2953 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_ph
@@ -1315,9 +1319,9 @@ more details.
 #define HIVE_ADDR_sp_isp_ph 0x7414
 #define HIVE_SIZE_sp_isp_ph 28
 
-/* function ia_css_ispctrl_sp_init_ds: 4286 */
+/* function ia_css_ispctrl_sp_init_ds: 447E */
 
-/* function get_xmem_base_addr_raw: 4637 */
+/* function get_xmem_base_addr_raw: 482F */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param
@@ -1349,23 +1353,23 @@ more details.
 
 /* function csi_rx_frontend_run: C1C */
 
-/* function __ia_css_dmaproxy_sp_configure_channel_text: 3D7C */
+/* function __ia_css_dmaproxy_sp_configure_channel_text: 3F74 */
 
-/* function ia_css_framebuf_sp_wait_for_in_frame: 669F */
+/* function ia_css_framebuf_sp_wait_for_in_frame: 68C8 */
 
-/* function ia_css_isys_stream_open: 62CB */
+/* function ia_css_isys_stream_open: 64F4 */
 
-/* function ia_css_sp_rawcopy_tag_frame: 5E57 */
+/* function ia_css_sp_rawcopy_tag_frame: 6074 */
 
 /* function input_system_channel_configure: 11D8 */
 
 /* function isp_hmem_clear: B2D */
 
-/* function ia_css_framebuf_sp_release_in_frame: 66E2 */
+/* function ia_css_framebuf_sp_release_in_frame: 690B */
 
 /* function stream2mmio_config: E15 */
 
-/* function ia_css_ispctrl_sp_start_binary: 40D8 */
+/* function ia_css_ispctrl_sp_start_binary: 42D0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_ddr_ptrs
@@ -1379,7 +1383,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 0x6A40
 #define HIVE_SIZE_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 20
 
-/* function ia_css_eventq_sp_recv: 3F60 */
+/* function ia_css_eventq_sp_recv: 4158 */
 
 /* function csi_rx_frontend_config: C74 */
 
@@ -1395,11 +1399,11 @@ more details.
 #define HIVE_ADDR_sp_isp_pool 0x390
 #define HIVE_SIZE_sp_isp_pool 4
 
-/* function ia_css_rmgr_sp_rel_gen: 63D1 */
+/* function ia_css_rmgr_sp_rel_gen: 65FA */
 
-/* function ia_css_tagger_sp_unblock_clients: 31C3 */
+/* function ia_css_tagger_sp_unblock_clients: 32F2 */
 
-/* function css_get_frame_processing_time_end: 28BA */
+/* function css_get_frame_processing_time_end: 28CA */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_event_any_pending_mask
@@ -1419,9 +1423,9 @@ more details.
 
 /* function debug_enqueue_isp: 27B */
 
-/* function qos_scheduler_update_stage_budget: 675E */
+/* function qos_scheduler_update_stage_budget: 6987 */
 
-/* function ia_css_spctrl_sp_uninit: 5EFF */
+/* function ia_css_spctrl_sp_uninit: 6128 */
 
 /* function csi_rx_backend_run: C62 */
 
@@ -1437,7 +1441,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_dis_bufs 0x6A54
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_dis_bufs 140
 
-/* function ia_css_tagger_buf_sp_lock_from_start: 353E */
+/* function ia_css_tagger_buf_sp_lock_from_start: 3736 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_isp_idle
@@ -1451,11 +1455,13 @@ more details.
 #define HIVE_ADDR_sp_sem_for_isp_idle 0x5934
 #define HIVE_SIZE_sp_sem_for_isp_idle 20
 
-/* function ia_css_dmaproxy_sp_write_byte_addr: 3C6A */
+/* function ia_css_dmaproxy_sp_write_byte_addr: 3E62 */
+
+/* function ia_css_dmaproxy_sp_init: 3DD9 */
 
-/* function ia_css_dmaproxy_sp_init: 3BE1 */
+/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 39A1 */
 
-/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 37A9 */
+/* function ia_css_tagger_buf_sp_set_capture_from_start: 3509 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_VAMEM_BASE
@@ -1469,7 +1475,7 @@ more details.
 #define HIVE_ADDR_sp_ISP_VAMEM_BASE 0x14
 #define HIVE_SIZE_sp_ISP_VAMEM_BASE 12
 
-/* function input_system_channel_sync: 6C32 */
+/* function input_system_channel_sync: 6E5B */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_rawcopy_sp_tagger
@@ -1495,9 +1501,9 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_exp_ids 0x6AE0
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_exp_ids 70
 
-/* function ia_css_queue_item_load: 5807 */
+/* function ia_css_queue_item_load: 59FF */
 
-/* function ia_css_spctrl_sp_get_state: 5EEA */
+/* function ia_css_spctrl_sp_get_state: 6113 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_callout_sp_thread
@@ -1537,41 +1543,41 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_input_stream_format 0x3E58
 #define HIVE_SIZE_sp_sp_isp_input_stream_format 20
 
-/* function __mod: 6A86 */
+/* function __mod: 6CAF */
 
-/* function ia_css_dmaproxy_sp_init_dmem_channel: 3CCB */
+/* function ia_css_dmaproxy_sp_init_dmem_channel: 3EC3 */
 
 /* function ia_css_thread_sp_join: 1311 */
 
-/* function ia_css_dmaproxy_sp_add_command: 7150 */
+/* function ia_css_dmaproxy_sp_add_command: 7379 */
 
-/* function ia_css_sp_metadata_thread_func: 5EE3 */
+/* function ia_css_sp_metadata_thread_func: 610C */
 
-/* function __sp_event_proxy_func_critical: 6B54 */
+/* function __sp_event_proxy_func_critical: 6D7D */
 
-/* function ia_css_pipeline_sp_wait_for_isys_stream_N: 6096 */
+/* function ia_css_pipeline_sp_wait_for_isys_stream_N: 62BF */
 
-/* function ia_css_sp_metadata_wait: 5EDC */
+/* function ia_css_sp_metadata_wait: 6105 */
 
 /* function ia_css_circbuf_peek_from_start: 151A */
 
-/* function ia_css_event_sp_encode: 3FEB */
+/* function ia_css_event_sp_encode: 41E3 */
 
 /* function ia_css_thread_sp_run: 1384 */
 
 /* function sp_isys_copy_func: 5AC */
 
-/* function ia_css_sp_isp_param_init_isp_memories: 52BA */
+/* function ia_css_sp_isp_param_init_isp_memories: 54B2 */
 
 /* function register_isr: 8B5 */
 
 /* function irq_raise: C8 */
 
-/* function ia_css_dmaproxy_sp_mmu_invalidate: 3B71 */
+/* function ia_css_dmaproxy_sp_mmu_invalidate: 3D69 */
 
 /* function csi_rx_backend_disable: C2E */
 
-/* function pipeline_sp_initialize_stage: 20BF */
+/* function pipeline_sp_initialize_stage: 20CF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_N_CSI_RX_FE_CTRL_DLANES
@@ -1585,13 +1591,13 @@ more details.
 #define HIVE_ADDR_sp_N_CSI_RX_FE_CTRL_DLANES 0x1C4
 #define HIVE_SIZE_sp_N_CSI_RX_FE_CTRL_DLANES 12
 
-/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 7030 */
+/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 7259 */
 
-/* function ia_css_ispctrl_sp_done_ds: 426D */
+/* function ia_css_ispctrl_sp_done_ds: 4465 */
 
 /* function csi_rx_backend_config: C85 */
 
-/* function ia_css_sp_isp_param_get_mem_inits: 5295 */
+/* function ia_css_sp_isp_param_get_mem_inits: 548D */
 
 /* function ia_css_parambuf_sp_init_buffer_queues: 1A27 */
 
@@ -1631,7 +1637,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_frames 0x6B28
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_frames 280
 
-/* function qos_scheduler_init_stage_budget: 67BC */
+/* function qos_scheduler_init_stage_budget: 69E5 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_buffer_queue_handle
@@ -1645,21 +1651,21 @@ more details.
 #define HIVE_ADDR_sp_sp2host_buffer_queue_handle 0x6C40
 #define HIVE_SIZE_sp_sp2host_buffer_queue_handle 96
 
-/* function ia_css_ispctrl_sp_init_isp_vars: 4F87 */
+/* function ia_css_ispctrl_sp_init_isp_vars: 517F */
 
-/* function ia_css_isys_stream_start: 61A9 */
+/* function ia_css_isys_stream_start: 63D2 */
 
 /* function sp_warning: 8E8 */
 
-/* function ia_css_rmgr_sp_vbuf_enqueue: 64C4 */
+/* function ia_css_rmgr_sp_vbuf_enqueue: 66ED */
 
-/* function ia_css_tagger_sp_tag_exp_id: 2A55 */
+/* function ia_css_tagger_sp_tag_exp_id: 2A88 */
 
-/* function ia_css_pipeline_sp_sfi_release_current_frame: 273C */
+/* function ia_css_pipeline_sp_sfi_release_current_frame: 274C */
 
-/* function ia_css_dmaproxy_sp_write: 3C81 */
+/* function ia_css_dmaproxy_sp_write: 3E79 */
 
-/* function ia_css_isys_stream_start_async: 6272 */
+/* function ia_css_isys_stream_start_async: 649B */
 
 /* function ia_css_parambuf_sp_release_in_param: 187B */
 
@@ -1687,7 +1693,7 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_addresses 0x7094
 #define HIVE_SIZE_sp_sp_isp_addresses 172
 
-/* function ia_css_rmgr_sp_acq_gen: 63E9 */
+/* function ia_css_rmgr_sp_acq_gen: 6612 */
 
 /* function input_system_input_port_open: 10E7 */
 
@@ -1715,7 +1721,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_queues_initialized 0x3E6C
 #define HIVE_SIZE_sp_host_sp_queues_initialized 4
 
-/* function ia_css_queue_uninit: 56D3 */
+/* function ia_css_queue_uninit: 58CB */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_ispctrl_sp_isp_started
@@ -1729,15 +1735,15 @@ more details.
 #define HIVE_ADDR_sp_ia_css_ispctrl_sp_isp_started 0x6D48
 #define HIVE_SIZE_sp_ia_css_ispctrl_sp_isp_started 4
 
-/* function ia_css_bufq_sp_release_dynamic_buf: 3815 */
+/* function ia_css_bufq_sp_release_dynamic_buf: 3A0D */
 
-/* function ia_css_dmaproxy_sp_set_height_exception: 3D8E */
+/* function ia_css_dmaproxy_sp_set_height_exception: 3F86 */
 
-/* function ia_css_dmaproxy_sp_init_vmem_channel: 3CFF */
+/* function ia_css_dmaproxy_sp_init_vmem_channel: 3EF7 */
 
 /* function csi_rx_backend_stop: C51 */
 
-/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 3C53 */
+/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 3E4B */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_vbuf_spref
@@ -1751,7 +1757,7 @@ more details.
 #define HIVE_ADDR_sp_vbuf_spref 0x394
 #define HIVE_SIZE_sp_vbuf_spref 4
 
-/* function ia_css_queue_enqueue: 561D */
+/* function ia_css_queue_enqueue: 5815 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_request
@@ -1765,7 +1771,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_request 0x5BE4
 #define HIVE_SIZE_sp_ia_css_flash_sp_request 4
 
-/* function ia_css_dmaproxy_sp_vmem_write: 3C24 */
+/* function ia_css_dmaproxy_sp_vmem_write: 3E1C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_tagger_frames
@@ -1793,13 +1799,13 @@ more details.
 
 /* function sp_generate_interrupts: 967 */
 
-/* function ia_css_pipeline_sp_start: 1FC2 */
+/* function ia_css_pipeline_sp_start: 1FD2 */
 
-/* function ia_css_thread_default_callout: 6CB1 */
+/* function ia_css_thread_default_callout: 6EDA */
 
 /* function csi_rx_backend_enable: C3F */
 
-/* function ia_css_sp_rawcopy_init: 5B54 */
+/* function ia_css_sp_rawcopy_init: 5D4C */
 
 /* function input_system_input_port_configure: 1139 */
 
@@ -1843,7 +1849,7 @@ more details.
 #define HIVE_ADDR_sp_ibuf_ctrl_master_ports 0x208
 #define HIVE_SIZE_sp_ibuf_ctrl_master_ports 12
 
-/* function css_get_frame_processing_time_start: 28C2 */
+/* function css_get_frame_processing_time_start: 28D2 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_frame
@@ -1857,7 +1863,7 @@ more details.
 #define HIVE_ADDR_sp_sp_all_cbs_frame 0x595C
 #define HIVE_SIZE_sp_sp_all_cbs_frame 16
 
-/* function ia_css_virtual_isys_sp_isr: 7190 */
+/* function ia_css_virtual_isys_sp_isr: 73B9 */
 
 /* function thread_sp_queue_print: 13A1 */
 
@@ -1875,11 +1881,11 @@ more details.
 #define HIVE_ADDR_sp_sem_for_str2mem 0x596C
 #define HIVE_SIZE_sp_sem_for_str2mem 20
 
-/* function ia_css_tagger_buf_sp_is_marked_from_start: 35A6 */
+/* function ia_css_tagger_buf_sp_is_marked_from_start: 379E */
 
-/* function ia_css_bufq_sp_acquire_dynamic_buf: 39CD */
+/* function ia_css_bufq_sp_acquire_dynamic_buf: 3BC5 */
 
-/* function ia_css_pipeline_sp_sfi_mode_is_enabled: 2890 */
+/* function ia_css_pipeline_sp_sfi_mode_is_enabled: 28A0 */
 
 /* function ia_css_circbuf_destroy: 162F */
 
@@ -1895,13 +1901,13 @@ more details.
 #define HIVE_ADDR_sp_ISP_PMEM_BASE 0xC
 #define HIVE_SIZE_sp_ISP_PMEM_BASE 4
 
-/* function ia_css_sp_isp_param_mem_load: 5228 */
+/* function ia_css_sp_isp_param_mem_load: 5420 */
 
-/* function ia_css_tagger_buf_sp_pop_from_start: 3392 */
+/* function ia_css_tagger_buf_sp_pop_from_start: 358A */
 
-/* function __div: 6A3E */
+/* function __div: 6C67 */
 
-/* function ia_css_rmgr_sp_refcount_release_vbuf: 64E3 */
+/* function ia_css_rmgr_sp_refcount_release_vbuf: 670C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_in_use
@@ -1915,7 +1921,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_use 0x5BE8
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_use 4
 
-/* function ia_css_thread_sem_sp_wait: 6D85 */
+/* function ia_css_thread_sem_sp_wait: 6FAE */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_sleep_mode
@@ -1929,7 +1935,7 @@ more details.
 #define HIVE_ADDR_sp_sp_sleep_mode 0x3E70
 #define HIVE_SIZE_sp_sp_sleep_mode 4
 
-/* function ia_css_tagger_buf_sp_push: 34A1 */
+/* function ia_css_tagger_buf_sp_push: 3699 */
 
 /* function mmu_invalidate_cache: D3 */
 
@@ -1945,7 +1951,7 @@ more details.
 #define HIVE_ADDR_sp_sp_max_cb_elems 0x148
 #define HIVE_SIZE_sp_sp_max_cb_elems 8
 
-/* function ia_css_queue_remote_init: 56F5 */
+/* function ia_css_queue_remote_init: 58ED */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_stop_req
@@ -1959,7 +1965,7 @@ more details.
 #define HIVE_ADDR_sp_isp_stop_req 0x5800
 #define HIVE_SIZE_sp_isp_stop_req 4
 
-/* function ia_css_pipeline_sp_sfi_request_next_frame: 2752 */
+/* function ia_css_pipeline_sp_sfi_request_next_frame: 2762 */
 
 
 #endif /* _sp_map_h_ */
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.c
index 5e293e8..70bf169 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.c
@@ -396,6 +396,56 @@ size);
 /* Code generated by genparam/gencode.c:gen_process_function() */
 
 static void
+ia_css_process_bnlm(
+	unsigned pipe_id,
+	const struct ia_css_pipeline_stage *stage,
+	struct ia_css_isp_parameters *params)
+{
+	assert(params != NULL);
+
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->dmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_encode((struct bnlm_dmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_DMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_DMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+	{
+		unsigned size   = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.size;
+
+		unsigned offset = stage->binary->info->mem_offsets.offsets.param->vmem.bnlm.offset;
+
+		if (size) {
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() enter:\n");
+
+			ia_css_bnlm_vmem_encode((struct bnlm_vmem_params *)
+					&stage->binary->mem_params.params[IA_CSS_PARAM_CLASS_PARAM][IA_CSS_ISP_VMEM].address[offset],
+					&params->bnlm_config,
+size);
+			params->isp_params_changed = true;
+			params->isp_mem_params_changed[pipe_id][stage->stage_num][IA_CSS_ISP_VMEM] = true;
+
+			ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_process_bnlm() leave:\n");
+		}
+
+	}
+}
+
+/* Code generated by genparam/gencode.c:gen_process_function() */
+
+static void
 ia_css_process_eed1_8(
 	unsigned pipe_id,
 	const struct ia_css_pipeline_stage *stage,
@@ -1913,6 +1963,7 @@ void (* ia_css_kernel_process_param[IA_CSS_NUM_PARAMETER_IDS])(
 	ia_css_process_dp,
 	ia_css_process_bnr,
 	ia_css_process_dpc2,
+	ia_css_process_bnlm,
 	ia_css_process_eed1_8,
 	ia_css_process_de,
 	ia_css_process_ecd,
@@ -2033,6 +2084,42 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_get_function() */
 
 static void
+ia_css_get_bnlm_config(const struct ia_css_isp_parameters *params,
+			struct ia_css_bnlm_config *config){
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() enter: "
+		"config=%p\n",config);
+
+	*config = params->bnlm_config;
+
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_get_bnlm_config() leave\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+}
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config)
+{
+	if (config == NULL)
+		return;
+
+	assert(params != NULL);
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE, "ia_css_set_bnlm_config() enter:\n");
+	ia_css_bnlm_debug_dtrace(config, IA_CSS_DEBUG_TRACE);
+	params->bnlm_config = *config;
+	params->config_changed[IA_CSS_BNLM_ID] = true;
+	ia_css_debug_dtrace(IA_CSS_DEBUG_TRACE_PRIVATE, "ia_css_set_bnlm_config() leave: "
+		"return_void\n");
+}
+
+/* Code generated by genparam/gencode.c:gen_get_function() */
+
+static void
 ia_css_get_eed1_8_config(const struct ia_css_isp_parameters *params,
 			struct ia_css_eed1_8_config *config){
 	if (config == NULL)
@@ -3576,6 +3663,7 @@ ia_css_get_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_get_dp_config(params, config->dp_config);
 	ia_css_get_dpc2_config(params, config->dpc2_config);
+	ia_css_get_bnlm_config(params, config->bnlm_config);
 	ia_css_get_eed1_8_config(params, config->eed1_8_config);
 	ia_css_get_wb_config(params, config->wb_config);
 	ia_css_get_tnr_config(params, config->tnr_config);
@@ -3628,6 +3716,7 @@ ia_css_set_configs(struct ia_css_isp_parameters *params,
 {
 	ia_css_set_dp_config(params, config->dp_config);
 	ia_css_set_dpc2_config(params, config->dpc2_config);
+	ia_css_set_bnlm_config(params, config->bnlm_config);
 	ia_css_set_eed1_8_config(params, config->eed1_8_config);
 	ia_css_set_wb_config(params, config->wb_config);
 	ia_css_set_tnr_config(params, config->tnr_config);
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.h
index 3acdc0c..2b971c8 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/hive_isp_css_2401_system_generated/ia_css_isp_params.h
@@ -29,6 +29,7 @@ enum ia_css_parameter_ids {
 	IA_CSS_DP_ID,
 	IA_CSS_BNR_ID,
 	IA_CSS_DPC2_ID,
+	IA_CSS_BNLM_ID,
 	IA_CSS_EED1_8_ID,
 	IA_CSS_DE_ID,
 	IA_CSS_ECD_ID,
@@ -88,6 +89,7 @@ struct ia_css_memory_offsets {
 		struct ia_css_isp_parameter dp;
 		struct ia_css_isp_parameter bnr;
 		struct ia_css_isp_parameter dpc2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter de;
 		struct ia_css_isp_parameter ecd;
@@ -129,6 +131,7 @@ struct ia_css_memory_offsets {
 	} dmem;
 	struct {
 		struct ia_css_isp_parameter anr2;
+		struct ia_css_isp_parameter bnlm;
 		struct ia_css_isp_parameter eed1_8;
 		struct ia_css_isp_parameter ob;
 		struct ia_css_isp_parameter macc1_5;
@@ -186,6 +189,12 @@ ia_css_set_dpc2_config(struct ia_css_isp_parameters *params,
 /* Code generated by genparam/gencode.c:gen_set_function() */
 
 void
+ia_css_set_bnlm_config(struct ia_css_isp_parameters *params,
+			const struct ia_css_bnlm_config *config);
+
+/* Code generated by genparam/gencode.c:gen_set_function() */
+
+void
 ia_css_set_eed1_8_config(struct ia_css_isp_parameters *params,
 			const struct ia_css_eed1_8_config *config);
 
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/spmem_dump.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/spmem_dump.c
index 1fc1f81..19b9448 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/spmem_dump.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_2401_system/spmem_dump.c
@@ -23,7 +23,7 @@ more details.
 
 /* function input_system_acquisition_stop: AD8 */
 
-/* function longjmp: 69E3 */
+/* function longjmp: 6C0E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SRST_MASK
@@ -37,11 +37,11 @@ more details.
 #define HIVE_ADDR_sp_HIVE_IF_SRST_MASK 0x1C8
 #define HIVE_SIZE_sp_HIVE_IF_SRST_MASK 16
 
-/* function tmpmem_init_dmem: 66F6 */
+/* function tmpmem_init_dmem: 6921 */
 
-/* function ia_css_isys_sp_token_map_receive_ack: 603A */
+/* function ia_css_isys_sp_token_map_receive_ack: 6265 */
 
-/* function ia_css_dmaproxy_sp_set_addr_B: 3539 */
+/* function ia_css_dmaproxy_sp_set_addr_B: 3731 */
 
 /* function ia_css_pipe_data_init_tagger_resources: A4F */
 
@@ -61,13 +61,13 @@ more details.
 #define HIVE_ADDR_sp_vbuf_mipi 0x6380
 #define HIVE_SIZE_sp_vbuf_mipi 12
 
-/* function ia_css_event_sp_decode: 372A */
+/* function ia_css_event_sp_decode: 3922 */
 
-/* function ia_css_queue_get_size: 4B54 */
+/* function ia_css_queue_get_size: 4D4C */
 
-/* function ia_css_queue_load: 516B */
+/* function ia_css_queue_load: 5363 */
 
-/* function setjmp: 69EC */
+/* function setjmp: 6C17 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_sp2host_isys_event_queue
@@ -81,11 +81,11 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_isys_event_queue 0x46D4
 #define HIVE_SIZE_sp_sem_for_sp2host_isys_event_queue 20
 
-/* function ia_css_dmaproxy_sp_wait_for_ack: 6F6D */
+/* function ia_css_dmaproxy_sp_wait_for_ack: 7198 */
 
-/* function ia_css_sp_rawcopy_func: 53A4 */
+/* function ia_css_sp_rawcopy_func: 559C */
 
-/* function ia_css_tagger_buf_sp_pop_marked: 2BB2 */
+/* function ia_css_tagger_buf_sp_pop_marked: 2DAA */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_stage
@@ -111,9 +111,9 @@ more details.
 #define HIVE_ADDR_sp_vbuf_raw 0x314
 #define HIVE_SIZE_sp_vbuf_raw 4
 
-/* function ia_css_sp_bin_copy_func: 52CB */
+/* function ia_css_sp_bin_copy_func: 54C3 */
 
-/* function ia_css_queue_item_store: 4EB9 */
+/* function ia_css_queue_item_store: 50B1 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_metadata_bufs
@@ -167,7 +167,7 @@ more details.
 
 /* function ia_css_thread_sp_main: D50 */
 
-/* function ia_css_ispctrl_sp_init_internal_buffers: 396B */
+/* function ia_css_ispctrl_sp_init_internal_buffers: 3B63 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_psys_event_queue_handle
@@ -193,7 +193,9 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp2host_psys_event_queue 0x46E8
 #define HIVE_SIZE_sp_sem_for_sp2host_psys_event_queue 20
 
-/* function ia_css_tagger_sp_propagate_frame: 2479 */
+/* function ia_css_tagger_buf_sp_get_capture_from_start: 2C98 */
+
+/* function ia_css_tagger_sp_propagate_frame: 24AC */
 
 /* function input_system_reg_load: B11 */
 
@@ -209,17 +211,17 @@ more details.
 #define HIVE_ADDR_sp_vbuf_handles 0x638C
 #define HIVE_SIZE_sp_vbuf_handles 960
 
-/* function ia_css_queue_store: 501F */
+/* function ia_css_queue_store: 5217 */
 
-/* function ia_css_sp_flash_register: 2DE7 */
+/* function ia_css_sp_flash_register: 2FDF */
 
-/* function ia_css_isys_sp_backend_create: 5CAD */
+/* function ia_css_isys_sp_backend_create: 5ED8 */
 
-/* function ia_css_pipeline_sp_init: 1886 */
+/* function ia_css_pipeline_sp_init: 1896 */
 
-/* function ia_css_tagger_sp_configure: 2369 */
+/* function ia_css_tagger_sp_configure: 239C */
 
-/* function ia_css_ispctrl_sp_end_binary: 3773 */
+/* function ia_css_ispctrl_sp_end_binary: 396B */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_per_frame_ddr_ptrs
@@ -283,7 +285,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_com 0x413C
 #define HIVE_SIZE_sp_host_sp_com 220
 
-/* function ia_css_queue_get_free_space: 4C7E */
+/* function ia_css_queue_get_free_space: 4E76 */
 
 /* function exec_image_pipe: 658 */
 
@@ -299,19 +301,19 @@ more details.
 #define HIVE_ADDR_sp_sp_init_dmem_data 0x6314
 #define HIVE_SIZE_sp_sp_init_dmem_data 24
 
-/* function ia_css_sp_metadata_start: 5A8A */
+/* function ia_css_sp_metadata_start: 5CB5 */
 
-/* function ia_css_bufq_sp_init_buffer_queues: 2E56 */
+/* function ia_css_bufq_sp_init_buffer_queues: 304E */
 
-/* function ia_css_pipeline_sp_stop: 1869 */
+/* function ia_css_pipeline_sp_stop: 1879 */
 
-/* function ia_css_tagger_sp_connect_pipes: 2853 */
+/* function ia_css_tagger_sp_connect_pipes: 2982 */
 
 /* function sp_isys_copy_wait: 6A1 */
 
 /* function is_isp_debug_buffer_full: 337 */
 
-/* function ia_css_dmaproxy_sp_configure_channel_from_info: 34A9 */
+/* function ia_css_dmaproxy_sp_configure_channel_from_info: 36A1 */
 
 /* function encode_and_post_timer_event: 9C4 */
 
@@ -327,7 +329,7 @@ more details.
 #define HIVE_ADDR_sp_sp_per_frame_data 0x4218
 #define HIVE_SIZE_sp_sp_per_frame_data 4
 
-/* function ia_css_rmgr_sp_vbuf_dequeue: 644A */
+/* function ia_css_rmgr_sp_vbuf_dequeue: 6675 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_host2sp_psys_event_queue_handle
@@ -357,7 +359,7 @@ more details.
 
 /* function ia_css_pipeline_sp_run: 143D */
 
-/* function memcpy: 6A8C */
+/* function memcpy: 6CB7 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_GP_DEVICE_BASE
@@ -385,13 +387,13 @@ more details.
 
 /* function input_system_reg_store: B18 */
 
-/* function ia_css_isys_sp_frontend_start: 5EC3 */
+/* function ia_css_isys_sp_frontend_start: 60EE */
 
-/* function ia_css_uds_sp_scale_params: 6795 */
+/* function ia_css_uds_sp_scale_params: 69C0 */
 
 /* function ia_css_circbuf_increase_size: E35 */
 
-/* function __divu: 6A0A */
+/* function __divu: 6C35 */
 
 /* function ia_css_thread_sp_get_state: C78 */
 
@@ -423,9 +425,9 @@ more details.
 
 /* function ia_css_parambuf_sp_handle_parameter_sets: 127F */
 
-/* function ia_css_spctrl_sp_set_state: 5AB9 */
+/* function ia_css_spctrl_sp_set_state: 5CE4 */
 
-/* function ia_css_thread_sem_sp_signal: 6C8E */
+/* function ia_css_thread_sem_sp_signal: 6EB9 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_IRQ_BASE
@@ -451,13 +453,13 @@ more details.
 #define HIVE_ADDR_sp_TIMED_CTRL_BASE 0x40
 #define HIVE_SIZE_sp_TIMED_CTRL_BASE 4
 
-/* function ia_css_isys_sp_isr: 715B */
+/* function ia_css_isys_sp_isr: 7386 */
 
-/* function ia_css_isys_sp_generate_exp_id: 625B */
+/* function ia_css_isys_sp_generate_exp_id: 6486 */
 
-/* function ia_css_rmgr_sp_init: 6345 */
+/* function ia_css_rmgr_sp_init: 6570 */
 
-/* function ia_css_thread_sem_sp_init: 6D5D */
+/* function ia_css_thread_sem_sp_init: 6F88 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_reading_cb_frame
@@ -483,15 +485,15 @@ more details.
 #define HIVE_ADDR_sp_is_isp_requested 0x328
 #define HIVE_SIZE_sp_is_isp_requested 4
 
-/* function ia_css_dmaproxy_sp_execute: 340F */
+/* function ia_css_dmaproxy_sp_execute: 3607 */
 
-/* function ia_css_queue_is_empty: 70BA */
+/* function ia_css_queue_is_empty: 72E5 */
 
-/* function ia_css_pipeline_sp_has_stopped: 185F */
+/* function ia_css_pipeline_sp_has_stopped: 186F */
 
 /* function ia_css_circbuf_extract: F39 */
 
-/* function ia_css_tagger_buf_sp_is_locked_from_start: 2CC8 */
+/* function ia_css_tagger_buf_sp_is_locked_from_start: 2EC0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_sp_thread
@@ -505,13 +507,13 @@ more details.
 #define HIVE_ADDR_sp_current_sp_thread 0x1DC
 #define HIVE_SIZE_sp_current_sp_thread 4
 
-/* function ia_css_spctrl_sp_get_spid: 5AC0 */
+/* function ia_css_spctrl_sp_get_spid: 5CEB */
 
-/* function ia_css_bufq_sp_reset_buffers: 2EDD */
+/* function ia_css_bufq_sp_reset_buffers: 30D5 */
 
-/* function ia_css_dmaproxy_sp_read_byte_addr: 6F9B */
+/* function ia_css_dmaproxy_sp_read_byte_addr: 71C6 */
 
-/* function ia_css_rmgr_sp_uninit: 633E */
+/* function ia_css_rmgr_sp_uninit: 6569 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_stack
@@ -529,7 +531,7 @@ more details.
 
 /* function ia_css_parambuf_sp_wait_for_in_param: 1048 */
 
-/* function ia_css_isys_sp_token_map_get_exp_id: 6123 */
+/* function ia_css_isys_sp_token_map_get_exp_id: 634E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cb_elems_param
@@ -581,7 +583,7 @@ more details.
 #define HIVE_ADDR_sp_sem_for_reading_cb_param 0x4760
 #define HIVE_SIZE_sp_sem_for_reading_cb_param 40
 
-/* function ia_css_queue_get_used_space: 4C32 */
+/* function ia_css_queue_get_used_space: 4E2A */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_cont_capt_start
@@ -607,11 +609,11 @@ more details.
 #define HIVE_ADDR_sp_tmp_heap 0x6078
 #define HIVE_SIZE_sp_tmp_heap 640
 
-/* function ia_css_rmgr_sp_get_num_vbuf: 664E */
+/* function ia_css_rmgr_sp_get_num_vbuf: 6879 */
 
-/* function ia_css_ispctrl_sp_output_compute_dma_info: 41AC */
+/* function ia_css_ispctrl_sp_output_compute_dma_info: 43A4 */
 
-/* function ia_css_tagger_sp_lock_exp_id: 2136 */
+/* function ia_css_tagger_sp_lock_exp_id: 2169 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_s3a_bufs
@@ -625,13 +627,13 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 0x4BF0
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_s3a_bufs 60
 
-/* function ia_css_queue_is_full: 4CC9 */
+/* function ia_css_queue_is_full: 4EC1 */
 
 /* function debug_buffer_init_isp: E4 */
 
-/* function ia_css_isys_sp_frontend_uninit: 5E7D */
+/* function ia_css_isys_sp_frontend_uninit: 60A8 */
 
-/* function ia_css_tagger_sp_exp_id_is_locked: 206C */
+/* function ia_css_tagger_sp_exp_id_is_locked: 2084 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_rmgr_sp_mipi_frame_sem
@@ -645,7 +647,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_rmgr_sp_mipi_frame_sem 0x674C
 #define HIVE_SIZE_sp_ia_css_rmgr_sp_mipi_frame_sem 60
 
-/* function ia_css_rmgr_sp_refcount_dump: 6425 */
+/* function ia_css_rmgr_sp_refcount_dump: 6650 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_pipe_private_isp_parameters_id
@@ -685,7 +687,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_isys_event_queue_handle 0x4C40
 #define HIVE_SIZE_sp_host2sp_isys_event_queue_handle 12
 
-/* function ia_css_thread_sp_yield: 6C0C */
+/* function ia_css_thread_sp_yield: 6E37 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param_desc
@@ -713,23 +715,23 @@ more details.
 
 /* function ia_css_thread_sp_fork: D05 */
 
-/* function ia_css_tagger_sp_destroy: 285D */
+/* function ia_css_tagger_sp_destroy: 298C */
 
-/* function ia_css_dmaproxy_sp_vmem_read: 33AF */
+/* function ia_css_dmaproxy_sp_vmem_read: 35A7 */
 
-/* function ia_css_ifmtr_sp_init: 62AC */
+/* function ia_css_ifmtr_sp_init: 64D7 */
 
 /* function initialize_sp_group: 668 */
 
-/* function ia_css_tagger_buf_sp_peek: 2AD4 */
+/* function ia_css_tagger_buf_sp_peek: 2CCC */
 
 /* function ia_css_thread_sp_init: D31 */
 
-/* function ia_css_isys_sp_reset_exp_id: 6253 */
+/* function ia_css_isys_sp_reset_exp_id: 647E */
 
-/* function qos_scheduler_update_fps: 6785 */
+/* function qos_scheduler_update_fps: 69B0 */
 
-/* function ia_css_ispctrl_sp_set_stream_base_addr: 48A0 */
+/* function ia_css_ispctrl_sp_set_stream_base_addr: 4A98 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_DMEM_BASE
@@ -755,9 +757,9 @@ more details.
 #define HIVE_ADDR_sp_SP_DMEM_BASE 0x4
 #define HIVE_SIZE_sp_SP_DMEM_BASE 4
 
-/* function __ia_css_queue_is_empty_text: 4B8F */
+/* function __ia_css_queue_is_empty_text: 4D87 */
 
-/* function ia_css_dmaproxy_sp_read: 3425 */
+/* function ia_css_dmaproxy_sp_read: 361D */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_raw_copy_line_count
@@ -783,7 +785,7 @@ more details.
 #define HIVE_ADDR_sp_host2sp_tag_cmd_queue_handle 0x4C4C
 #define HIVE_SIZE_sp_host2sp_tag_cmd_queue_handle 12
 
-/* function ia_css_queue_peek: 4BA8 */
+/* function ia_css_queue_peek: 4DA0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_frame_cnt
@@ -823,15 +825,15 @@ more details.
 
 /* function encode_and_post_sp_event_non_blocking: A0C */
 
-/* function ia_css_isys_sp_frontend_destroy: 5F55 */
+/* function ia_css_isys_sp_frontend_destroy: 6180 */
 
 /* function is_ddr_debug_buffer_full: 2CC */
 
-/* function ia_css_isys_sp_frontend_stop: 5E95 */
+/* function ia_css_isys_sp_frontend_stop: 60C0 */
 
-/* function ia_css_isys_sp_token_map_init: 61F1 */
+/* function ia_css_isys_sp_token_map_init: 641C */
 
-/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 2B24 */
+/* function ia_css_tagger_buf_sp_get_oldest_marked_offset: 2D1C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_threads_fiber
@@ -849,9 +851,9 @@ more details.
 
 /* function debug_enqueue_ddr: EE */
 
-/* function ia_css_rmgr_sp_refcount_init_vbuf: 63E0 */
+/* function ia_css_rmgr_sp_refcount_init_vbuf: 660B */
 
-/* function dmaproxy_sp_read_write: 7039 */
+/* function dmaproxy_sp_read_write: 7264 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_dmaproxy_isp_dma_cmd_buffer
@@ -889,17 +891,17 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_service 0x31A0
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_service 4
 
-/* function ia_css_dmaproxy_sp_process: 6D85 */
+/* function ia_css_dmaproxy_sp_process: 6FB0 */
 
-/* function ia_css_tagger_buf_sp_mark_from_end: 2DAC */
+/* function ia_css_tagger_buf_sp_mark_from_end: 2FA4 */
 
-/* function ia_css_isys_sp_backend_rcv_acquire_ack: 5B62 */
+/* function ia_css_isys_sp_backend_rcv_acquire_ack: 5D8D */
 
-/* function ia_css_isys_sp_backend_pre_acquire_request: 5B78 */
+/* function ia_css_isys_sp_backend_pre_acquire_request: 5DA3 */
 
-/* function ia_css_ispctrl_sp_init_cs: 386E */
+/* function ia_css_ispctrl_sp_init_cs: 3A66 */
 
-/* function ia_css_spctrl_sp_init: 5ACE */
+/* function ia_css_spctrl_sp_init: 5CF9 */
 
 /* function sp_event_proxy_init: 6C4 */
 
@@ -963,11 +965,11 @@ more details.
 #define HIVE_ADDR_sp_INPUT_FORMATTER_BASE 0x4C
 #define HIVE_SIZE_sp_INPUT_FORMATTER_BASE 16
 
-/* function sp_dma_proxy_reset_channels: 3694 */
+/* function sp_dma_proxy_reset_channels: 388C */
 
-/* function ia_css_isys_sp_backend_acquire: 5C83 */
+/* function ia_css_isys_sp_backend_acquire: 5EAE */
 
-/* function ia_css_tagger_sp_update_size: 2AA3 */
+/* function ia_css_tagger_sp_update_size: 2C2E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_host_sp_queue
@@ -983,7 +985,7 @@ more details.
 
 /* function thread_fiber_sp_create: D9D */
 
-/* function ia_css_dmaproxy_sp_set_increments: 3526 */
+/* function ia_css_dmaproxy_sp_set_increments: 371E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_writing_cb_frame
@@ -1019,21 +1021,23 @@ more details.
 #endif
 #define HIVE_ADDR_sp_sp_start_isp_entry 0x453
 
-/* function ia_css_tagger_buf_sp_unmark_all: 2D30 */
+/* function ia_css_tagger_buf_sp_unmark_all: 2F28 */
+
+/* function ia_css_tagger_buf_sp_unmark_from_start: 2F69 */
 
-/* function ia_css_tagger_buf_sp_unmark_from_start: 2D71 */
+/* function ia_css_dmaproxy_sp_channel_acquire: 38B8 */
 
-/* function ia_css_dmaproxy_sp_channel_acquire: 36C0 */
+/* function ia_css_rmgr_sp_add_num_vbuf: 6855 */
 
-/* function ia_css_rmgr_sp_add_num_vbuf: 662A */
+/* function ia_css_tagger_frame_in_capture_pipe: 2030 */
 
-/* function ia_css_isys_sp_token_map_create: 623A */
+/* function ia_css_isys_sp_token_map_create: 6465 */
 
-/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 337B */
+/* function __ia_css_dmaproxy_sp_wait_for_ack_text: 3573 */
 
-/* function ia_css_tagger_sp_acquire_buf_elem: 2044 */
+/* function ia_css_tagger_sp_acquire_buf_elem: 205C */
 
-/* function ia_css_bufq_sp_is_dynamic_buffer: 3227 */
+/* function ia_css_bufq_sp_is_dynamic_buffer: 341F */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_group
@@ -1061,9 +1065,9 @@ more details.
 
 /* function ia_css_thread_sp_kill: CCB */
 
-/* function ia_css_tagger_sp_create: 2A51 */
+/* function ia_css_tagger_sp_create: 2BDC */
 
-/* function tmpmem_acquire_dmem: 66D7 */
+/* function tmpmem_acquire_dmem: 6902 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_MMU_BASE
@@ -1077,9 +1081,9 @@ more details.
 #define HIVE_ADDR_sp_MMU_BASE 0x24
 #define HIVE_SIZE_sp_MMU_BASE 8
 
-/* function ia_css_dmaproxy_sp_channel_release: 36AC */
+/* function ia_css_dmaproxy_sp_channel_release: 38A4 */
 
-/* function ia_css_dmaproxy_sp_is_idle: 368C */
+/* function ia_css_dmaproxy_sp_is_idle: 3884 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_qos_start
@@ -1095,9 +1099,9 @@ more details.
 
 /* function isp_hmem_load: B4F */
 
-/* function ia_css_tagger_sp_release_buf_elem: 2020 */
+/* function ia_css_tagger_sp_release_buf_elem: 2038 */
 
-/* function ia_css_eventq_sp_send: 3702 */
+/* function ia_css_eventq_sp_send: 38FA */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_isys_sp_error_cnt
@@ -1111,7 +1115,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_isys_sp_error_cnt 0x6338
 #define HIVE_SIZE_sp_ia_css_isys_sp_error_cnt 16
 
-/* function ia_css_tagger_buf_sp_unlock_from_start: 2C60 */
+/* function ia_css_tagger_buf_sp_unlock_from_start: 2E58 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_debug_buffer_ddr_address
@@ -1127,35 +1131,35 @@ more details.
 
 /* function sp_isys_copy_request: 6A8 */
 
-/* function ia_css_rmgr_sp_refcount_retain_vbuf: 64BA */
+/* function ia_css_rmgr_sp_refcount_retain_vbuf: 66E5 */
 
 /* function ia_css_thread_sp_set_priority: CC3 */
 
 /* function sizeof_hmem: BF6 */
 
-/* function tmpmem_release_dmem: 66C6 */
+/* function tmpmem_release_dmem: 68F1 */
 
 /* function cnd_input_system_cfg: 392 */
 
-/* function __ia_css_sp_rawcopy_func_critical: 70E4 */
+/* function __ia_css_sp_rawcopy_func_critical: 730F */
 
-/* function __ia_css_dmaproxy_sp_process_text: 331F */
+/* function __ia_css_dmaproxy_sp_process_text: 3517 */
 
-/* function ia_css_dmaproxy_sp_set_width_exception: 3511 */
+/* function ia_css_dmaproxy_sp_set_width_exception: 3709 */
 
 /* function sp_event_assert: 845 */
 
-/* function ia_css_flash_sp_init_internal_params: 2E4B */
+/* function ia_css_flash_sp_init_internal_params: 3043 */
 
-/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 2B66 */
+/* function ia_css_tagger_buf_sp_pop_unmarked_and_unlocked: 2D5E */
 
-/* function __modu: 6A50 */
+/* function __modu: 6C7B */
 
-/* function ia_css_dmaproxy_sp_init_isp_vector: 3381 */
+/* function ia_css_dmaproxy_sp_init_isp_vector: 3579 */
 
 /* function isp_vamem_store: 0 */
 
-/* function ia_css_tagger_sp_set_copy_pipe: 2A48 */
+/* function ia_css_tagger_sp_set_copy_pipe: 2BD3 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_GDC_BASE
@@ -1169,11 +1173,11 @@ more details.
 #define HIVE_ADDR_sp_GDC_BASE 0x44
 #define HIVE_SIZE_sp_GDC_BASE 8
 
-/* function ia_css_queue_local_init: 4E93 */
+/* function ia_css_queue_local_init: 508B */
 
-/* function sp_event_proxy_callout_func: 6B1D */
+/* function sp_event_proxy_callout_func: 6D48 */
 
-/* function qos_scheduler_schedule_stage: 6731 */
+/* function qos_scheduler_schedule_stage: 695C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_thread_sp_num_ready_threads
@@ -1199,15 +1203,15 @@ more details.
 #define HIVE_ADDR_sp_sp_threads_stack_size 0x180
 #define HIVE_SIZE_sp_sp_threads_stack_size 28
 
-/* function ia_css_ispctrl_sp_isp_done_row_striping: 4192 */
+/* function ia_css_ispctrl_sp_isp_done_row_striping: 438A */
 
-/* function __ia_css_isys_sp_isr_text: 5F7F */
+/* function __ia_css_isys_sp_isr_text: 61AA */
 
-/* function ia_css_queue_dequeue: 4D11 */
+/* function ia_css_queue_dequeue: 4F09 */
 
-/* function is_qos_standalone_mode: 670C */
+/* function is_qos_standalone_mode: 6937 */
 
-/* function ia_css_dmaproxy_sp_configure_channel: 6FB2 */
+/* function ia_css_dmaproxy_sp_configure_channel: 71DD */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_current_thread_fiber_sp
@@ -1223,7 +1227,7 @@ more details.
 
 /* function ia_css_circbuf_pop: FCD */
 
-/* function memset: 6ACF */
+/* function memset: 6CFA */
 
 /* function irq_raise_set_token: B6 */
 
@@ -1239,9 +1243,9 @@ more details.
 #define HIVE_ADDR_sp_GPIO_BASE 0x3C
 #define HIVE_SIZE_sp_GPIO_BASE 4
 
-/* function ia_css_pipeline_acc_stage_enable: 1818 */
+/* function ia_css_pipeline_acc_stage_enable: 1828 */
 
-/* function ia_css_tagger_sp_unlock_exp_id: 2091 */
+/* function ia_css_tagger_sp_unlock_exp_id: 20A9 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_ph
@@ -1255,11 +1259,11 @@ more details.
 #define HIVE_ADDR_sp_isp_ph 0x6348
 #define HIVE_SIZE_sp_isp_ph 28
 
-/* function ia_css_isys_sp_token_map_flush: 617F */
+/* function ia_css_isys_sp_token_map_flush: 63AA */
 
-/* function ia_css_ispctrl_sp_init_ds: 39FA */
+/* function ia_css_ispctrl_sp_init_ds: 3BF2 */
 
-/* function get_xmem_base_addr_raw: 3DB5 */
+/* function get_xmem_base_addr_raw: 3FAD */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_param
@@ -1287,23 +1291,23 @@ more details.
 #define HIVE_ADDR_sp_sem_for_sp_group 0x47F0
 #define HIVE_SIZE_sp_sem_for_sp_group 20
 
-/* function __ia_css_dmaproxy_sp_configure_channel_text: 34F0 */
+/* function __ia_css_dmaproxy_sp_configure_channel_text: 36E8 */
 
-/* function ia_css_framebuf_sp_wait_for_in_frame: 6655 */
+/* function ia_css_framebuf_sp_wait_for_in_frame: 6880 */
 
-/* function ia_css_sp_rawcopy_tag_frame: 57EB */
+/* function ia_css_sp_rawcopy_tag_frame: 5A0A */
 
 /* function isp_hmem_clear: B1F */
 
-/* function ia_css_framebuf_sp_release_in_frame: 6698 */
+/* function ia_css_framebuf_sp_release_in_frame: 68C3 */
 
-/* function ia_css_isys_sp_backend_snd_acquire_request: 5BD5 */
+/* function ia_css_isys_sp_backend_snd_acquire_request: 5E00 */
 
-/* function ia_css_isys_sp_token_map_is_full: 6006 */
+/* function ia_css_isys_sp_token_map_is_full: 6231 */
 
 /* function input_system_acquisition_run: AF3 */
 
-/* function ia_css_ispctrl_sp_start_binary: 384C */
+/* function ia_css_ispctrl_sp_start_binary: 3A44 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_h_pipe_private_ddr_ptrs
@@ -1317,7 +1321,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 0x5958
 #define HIVE_SIZE_sp_ia_css_bufq_sp_h_pipe_private_ddr_ptrs 20
 
-/* function ia_css_eventq_sp_recv: 36D4 */
+/* function ia_css_eventq_sp_recv: 38CC */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_pool
@@ -1331,11 +1335,11 @@ more details.
 #define HIVE_ADDR_sp_isp_pool 0x308
 #define HIVE_SIZE_sp_isp_pool 4
 
-/* function ia_css_rmgr_sp_rel_gen: 6387 */
+/* function ia_css_rmgr_sp_rel_gen: 65B2 */
 
-/* function ia_css_tagger_sp_unblock_clients: 2919 */
+/* function ia_css_tagger_sp_unblock_clients: 2A48 */
 
-/* function css_get_frame_processing_time_end: 2010 */
+/* function css_get_frame_processing_time_end: 2020 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_event_any_pending_mask
@@ -1349,15 +1353,15 @@ more details.
 #define HIVE_ADDR_sp_event_any_pending_mask 0x320
 #define HIVE_SIZE_sp_event_any_pending_mask 8
 
-/* function ia_css_isys_sp_backend_push: 5B8C */
+/* function ia_css_isys_sp_backend_push: 5DB7 */
 
 /* function sh_css_decode_tag_descr: 352 */
 
 /* function debug_enqueue_isp: 27B */
 
-/* function qos_scheduler_update_stage_budget: 6714 */
+/* function qos_scheduler_update_stage_budget: 693F */
 
-/* function ia_css_spctrl_sp_uninit: 5AC7 */
+/* function ia_css_spctrl_sp_uninit: 5CF2 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SWITCH_CODE
@@ -1383,7 +1387,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_dis_bufs 0x596C
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_dis_bufs 140
 
-/* function ia_css_tagger_buf_sp_lock_from_start: 2C94 */
+/* function ia_css_tagger_buf_sp_lock_from_start: 2E8C */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_isp_idle
@@ -1397,11 +1401,13 @@ more details.
 #define HIVE_ADDR_sp_sem_for_isp_idle 0x4804
 #define HIVE_SIZE_sp_sem_for_isp_idle 20
 
-/* function ia_css_dmaproxy_sp_write_byte_addr: 33DE */
+/* function ia_css_dmaproxy_sp_write_byte_addr: 35D6 */
+
+/* function ia_css_dmaproxy_sp_init: 354D */
 
-/* function ia_css_dmaproxy_sp_init: 3355 */
+/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 3115 */
 
-/* function ia_css_bufq_sp_release_dynamic_buf_clock_tick: 2F1D */
+/* function ia_css_tagger_buf_sp_set_capture_from_start: 2C5F */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ISP_VAMEM_BASE
@@ -1439,11 +1445,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_exp_ids 0x59F8
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_exp_ids 70
 
-/* function ia_css_queue_item_load: 4F85 */
+/* function ia_css_queue_item_load: 517D */
 
-/* function ia_css_spctrl_sp_get_state: 5AB2 */
+/* function ia_css_spctrl_sp_get_state: 5CDD */
 
-/* function ia_css_isys_sp_token_map_uninit: 619C */
+/* function ia_css_isys_sp_token_map_uninit: 63C7 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_callout_sp_thread
@@ -1471,7 +1477,7 @@ more details.
 #define HIVE_ADDR_sp_SP_PMEM_BASE 0x0
 #define HIVE_SIZE_sp_SP_PMEM_BASE 4
 
-/* function ia_css_isys_sp_token_map_snd_acquire_req: 610C */
+/* function ia_css_isys_sp_token_map_snd_acquire_req: 6337 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_isp_input_stream_format
@@ -1485,39 +1491,39 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_input_stream_format 0x4120
 #define HIVE_SIZE_sp_sp_isp_input_stream_format 20
 
-/* function __mod: 6A3C */
+/* function __mod: 6C67 */
 
-/* function ia_css_dmaproxy_sp_init_dmem_channel: 343F */
+/* function ia_css_dmaproxy_sp_init_dmem_channel: 3637 */
 
 /* function ia_css_thread_sp_join: CF4 */
 
-/* function ia_css_dmaproxy_sp_add_command: 70A4 */
+/* function ia_css_dmaproxy_sp_add_command: 72CF */
 
-/* function ia_css_sp_metadata_thread_func: 598A */
+/* function ia_css_sp_metadata_thread_func: 5BB5 */
 
-/* function __sp_event_proxy_func_critical: 6B0A */
+/* function __sp_event_proxy_func_critical: 6D35 */
 
-/* function ia_css_sp_metadata_wait: 5A79 */
+/* function ia_css_sp_metadata_wait: 5CA4 */
 
 /* function ia_css_circbuf_peek_from_start: EFD */
 
-/* function ia_css_event_sp_encode: 375F */
+/* function ia_css_event_sp_encode: 3957 */
 
 /* function ia_css_thread_sp_run: D67 */
 
 /* function sp_isys_copy_func: 68A */
 
-/* function ia_css_isys_sp_backend_flush: 5BF5 */
+/* function ia_css_isys_sp_backend_flush: 5E20 */
 
-/* function ia_css_isys_sp_backend_frame_exists: 5B11 */
+/* function ia_css_isys_sp_backend_frame_exists: 5D3C */
 
-/* function ia_css_sp_isp_param_init_isp_memories: 4A38 */
+/* function ia_css_sp_isp_param_init_isp_memories: 4C30 */
 
 /* function register_isr: 83D */
 
 /* function irq_raise: C8 */
 
-/* function ia_css_dmaproxy_sp_mmu_invalidate: 32E5 */
+/* function ia_css_dmaproxy_sp_mmu_invalidate: 34DD */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_HIVE_IF_SRST_ADDRESS
@@ -1531,7 +1537,7 @@ more details.
 #define HIVE_ADDR_sp_HIVE_IF_SRST_ADDRESS 0x1B8
 #define HIVE_SIZE_sp_HIVE_IF_SRST_ADDRESS 16
 
-/* function pipeline_sp_initialize_stage: 195E */
+/* function pipeline_sp_initialize_stage: 196E */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_isys_sp_frontend_states
@@ -1545,11 +1551,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_isys_sp_frontend_states 0x632C
 #define HIVE_SIZE_sp_ia_css_isys_sp_frontend_states 12
 
-/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 6F84 */
+/* function ia_css_dmaproxy_sp_read_byte_addr_mmio: 71AF */
 
-/* function ia_css_ispctrl_sp_done_ds: 39E1 */
+/* function ia_css_ispctrl_sp_done_ds: 3BD9 */
 
-/* function ia_css_sp_isp_param_get_mem_inits: 4A13 */
+/* function ia_css_sp_isp_param_get_mem_inits: 4C0B */
 
 /* function ia_css_parambuf_sp_init_buffer_queues: 13F1 */
 
@@ -1591,11 +1597,11 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_pipe_private_frames 0x5A40
 #define HIVE_SIZE_sp_ia_css_bufq_sp_pipe_private_frames 280
 
-/* function qos_scheduler_init_stage_budget: 6772 */
+/* function qos_scheduler_init_stage_budget: 699D */
 
-/* function ia_css_isys_sp_backend_release: 5C6A */
+/* function ia_css_isys_sp_backend_release: 5E95 */
 
-/* function ia_css_isys_sp_backend_destroy: 5C94 */
+/* function ia_css_isys_sp_backend_destroy: 5EBF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp2host_buffer_queue_handle
@@ -1609,19 +1615,19 @@ more details.
 #define HIVE_ADDR_sp_sp2host_buffer_queue_handle 0x5B58
 #define HIVE_SIZE_sp_sp2host_buffer_queue_handle 96
 
-/* function ia_css_isys_sp_token_map_check_mipi_frame_size: 60D0 */
+/* function ia_css_isys_sp_token_map_check_mipi_frame_size: 62FB */
 
-/* function ia_css_ispctrl_sp_init_isp_vars: 4705 */
+/* function ia_css_ispctrl_sp_init_isp_vars: 48FD */
 
-/* function ia_css_isys_sp_frontend_has_empty_mipi_buffer_cb: 5CE6 */
+/* function ia_css_isys_sp_frontend_has_empty_mipi_buffer_cb: 5F11 */
 
 /* function sp_warning: 870 */
 
-/* function ia_css_rmgr_sp_vbuf_enqueue: 647A */
+/* function ia_css_rmgr_sp_vbuf_enqueue: 66A5 */
 
-/* function ia_css_tagger_sp_tag_exp_id: 21AB */
+/* function ia_css_tagger_sp_tag_exp_id: 21DE */
 
-/* function ia_css_dmaproxy_sp_write: 33F5 */
+/* function ia_css_dmaproxy_sp_write: 35ED */
 
 /* function ia_css_parambuf_sp_release_in_param: 1245 */
 
@@ -1649,7 +1655,7 @@ more details.
 #define HIVE_ADDR_sp_sp_isp_addresses 0x5FAC
 #define HIVE_SIZE_sp_sp_isp_addresses 172
 
-/* function ia_css_rmgr_sp_acq_gen: 639F */
+/* function ia_css_rmgr_sp_acq_gen: 65CA */
 
 /* function receiver_reg_load: ACA */
 
@@ -1677,7 +1683,7 @@ more details.
 #define HIVE_ADDR_sp_host_sp_queues_initialized 0x4134
 #define HIVE_SIZE_sp_host_sp_queues_initialized 4
 
-/* function ia_css_queue_uninit: 4E51 */
+/* function ia_css_queue_uninit: 5049 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_ispctrl_sp_isp_started
@@ -1691,13 +1697,13 @@ more details.
 #define HIVE_ADDR_sp_ia_css_ispctrl_sp_isp_started 0x5C60
 #define HIVE_SIZE_sp_ia_css_ispctrl_sp_isp_started 4
 
-/* function ia_css_bufq_sp_release_dynamic_buf: 2F89 */
+/* function ia_css_bufq_sp_release_dynamic_buf: 3181 */
 
-/* function ia_css_dmaproxy_sp_set_height_exception: 3502 */
+/* function ia_css_dmaproxy_sp_set_height_exception: 36FA */
 
-/* function ia_css_dmaproxy_sp_init_vmem_channel: 3473 */
+/* function ia_css_dmaproxy_sp_init_vmem_channel: 366B */
 
-/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 33C7 */
+/* function ia_css_dmaproxy_sp_write_byte_addr_mmio: 35BF */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_vbuf_spref
@@ -1723,7 +1729,7 @@ more details.
 #define HIVE_ADDR_sp_sp_metadata_thread 0x4A00
 #define HIVE_SIZE_sp_sp_metadata_thread 72
 
-/* function ia_css_queue_enqueue: 4D9B */
+/* function ia_css_queue_enqueue: 4F93 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_request
@@ -1737,7 +1743,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_request 0x4AFC
 #define HIVE_SIZE_sp_ia_css_flash_sp_request 4
 
-/* function ia_css_dmaproxy_sp_vmem_write: 3398 */
+/* function ia_css_dmaproxy_sp_vmem_write: 3590 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_tagger_frames
@@ -1751,7 +1757,7 @@ more details.
 #define HIVE_ADDR_sp_tagger_frames 0x4A50
 #define HIVE_SIZE_sp_tagger_frames 168
 
-/* function ia_css_isys_sp_token_map_snd_capture_req: 612E */
+/* function ia_css_isys_sp_token_map_snd_capture_req: 6359 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sem_for_reading_if
@@ -1767,11 +1773,11 @@ more details.
 
 /* function sp_generate_interrupts: 8EF */
 
-/* function ia_css_pipeline_sp_start: 1871 */
+/* function ia_css_pipeline_sp_start: 1881 */
 
-/* function ia_css_thread_default_callout: 6C05 */
+/* function ia_css_thread_default_callout: 6E30 */
 
-/* function ia_css_sp_rawcopy_init: 538C */
+/* function ia_css_sp_rawcopy_init: 5584 */
 
 /* function tmr_clock_read: 1412 */
 
@@ -1787,7 +1793,7 @@ more details.
 #define HIVE_ADDR_sp_ISP_BAMEM_BASE 0x318
 #define HIVE_SIZE_sp_ISP_BAMEM_BASE 4
 
-/* function ia_css_isys_sp_frontend_rcv_capture_ack: 5D95 */
+/* function ia_css_isys_sp_frontend_rcv_capture_ack: 5FC0 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_bufq_sp_sems_for_sp2host_buf_queues
@@ -1801,7 +1807,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_bufq_sp_sems_for_sp2host_buf_queues 0x5BB8
 #define HIVE_SIZE_sp_ia_css_bufq_sp_sems_for_sp2host_buf_queues 160
 
-/* function css_get_frame_processing_time_start: 2018 */
+/* function css_get_frame_processing_time_start: 2028 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_all_cbs_frame
@@ -1831,9 +1837,9 @@ more details.
 #define HIVE_ADDR_sp_sem_for_str2mem 0x483C
 #define HIVE_SIZE_sp_sem_for_str2mem 20
 
-/* function ia_css_tagger_buf_sp_is_marked_from_start: 2CFC */
+/* function ia_css_tagger_buf_sp_is_marked_from_start: 2EF4 */
 
-/* function ia_css_bufq_sp_acquire_dynamic_buf: 3141 */
+/* function ia_css_bufq_sp_acquire_dynamic_buf: 3339 */
 
 /* function ia_css_circbuf_destroy: 1012 */
 
@@ -1849,15 +1855,15 @@ more details.
 #define HIVE_ADDR_sp_ISP_PMEM_BASE 0xC
 #define HIVE_SIZE_sp_ISP_PMEM_BASE 4
 
-/* function ia_css_sp_isp_param_mem_load: 49A6 */
+/* function ia_css_sp_isp_param_mem_load: 4B9E */
 
-/* function ia_css_tagger_buf_sp_pop_from_start: 2AE8 */
+/* function ia_css_tagger_buf_sp_pop_from_start: 2CE0 */
 
-/* function __div: 69F4 */
+/* function __div: 6C1F */
 
-/* function ia_css_isys_sp_frontend_create: 5F66 */
+/* function ia_css_isys_sp_frontend_create: 6191 */
 
-/* function ia_css_rmgr_sp_refcount_release_vbuf: 6499 */
+/* function ia_css_rmgr_sp_refcount_release_vbuf: 66C4 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_ia_css_flash_sp_in_use
@@ -1871,7 +1877,7 @@ more details.
 #define HIVE_ADDR_sp_ia_css_flash_sp_in_use 0x4B00
 #define HIVE_SIZE_sp_ia_css_flash_sp_in_use 4
 
-/* function ia_css_thread_sem_sp_wait: 6CD9 */
+/* function ia_css_thread_sem_sp_wait: 6F04 */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_sp_sleep_mode
@@ -1885,7 +1891,7 @@ more details.
 #define HIVE_ADDR_sp_sp_sleep_mode 0x4138
 #define HIVE_SIZE_sp_sp_sleep_mode 4
 
-/* function ia_css_tagger_buf_sp_push: 2BF7 */
+/* function ia_css_tagger_buf_sp_push: 2DEF */
 
 /* function mmu_invalidate_cache: D3 */
 
@@ -1901,7 +1907,7 @@ more details.
 #define HIVE_ADDR_sp_sp_max_cb_elems 0x148
 #define HIVE_SIZE_sp_sp_max_cb_elems 8
 
-/* function ia_css_queue_remote_init: 4E73 */
+/* function ia_css_queue_remote_init: 506B */
 
 #ifndef HIVE_MULTIPLE_PROGRAMS
 #ifndef HIVE_MEM_isp_stop_req
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_api_version.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_api_version.h
index 672127f..49e20f8 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_api_version.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/css_api_version.h
@@ -34,7 +34,7 @@ The version string has four dot-separated numbers, read left to right:
 
 */
 
-#define CSS_API_VERSION_STRING	"2.1.21.0"
+#define CSS_API_VERSION_STRING	"2.1.21.3"
 
 /*
 Change log
@@ -472,6 +472,19 @@ v2.1.20.21, insert copyright header on CSS-API files
 v2.1.21.0, Reorder EED1_8 kernel parameters in CSS API
 - Reorder EED1_8 fields in ia_css_eed1_8_config
 
+v2.1.21.1, Update FW Warnings in CSS_API
+- Update FW Warnings in CSS API
+
+v2.1.21.3 (1 changes parallel), Enable BNLM API
+- add ia_css_bnlm_config struct
+
+v2.1.21.3 (1 changes parallel), Provide CSS Interface to select correct raw frame type
+- Add an enum ia_css_raw_type to ia_css_stream_input_config
+- For new RGBIR sensor use cases ia_css_raw_type should be set to
+- IA_CSS_RAW_RGBIR_IR_ON_Gr for IR on Gr case
+- IA_CSS_RAW_RGBIR_IR_ON_Gb for IR on Gb case
+- Frame type for future RAW hybrid sensors can be added here
+
 */
 
 #endif /*__CSS_API_VERSION_H*/
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css.h
index 252ccd4..7acd778 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css.h
@@ -1,4 +1,4 @@
-/* Release Version: irci_ecr-master_20160201_0200 */
+/* Release Version: irci_ecr-master_20160308_0202 */
 /**
 Support for Intel Camera Imaging ISP subsystem.
 Copyright (c) 2010 - 2015, Intel Corporation.
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_err.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_err.h
index 439c308..d15ab23 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_err.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_err.h
@@ -58,6 +58,17 @@ enum ia_css_fw_warning {
 		This warning can be avoided by unlocking locked frame-buffers more timely. */
 	IA_CSS_FW_WARNING_FRAME_PARAM_MISMATCH, /** < Frame and param pair mismatched in tagger.
 		This warning can be avoided by providing a param set for each frame. */
+	IA_CSS_FW_WARNING_UNLOCK_EXP_ID_FAILED, /** < Unlock request for frame exp_id failed.
+		Exposure ID could not be found on the circular buffer.  This warning can be
+		avoided by not requesting a frame to be unlocked that was previously unlocked.*/
+	IA_CSS_FW_WARNING_CAPTURE_EXP_ID_FAILED, /** <Failed to set the 'capture' indicator when
+		sending a marked frame to the capture pipe.  The exposure ID could not be found
+		on the circular buffer.  This warning can be avoided by not unlocking a frame
+		buffer marked for capture.*/
+	IA_CSS_FW_WARNING_UNLOCK_EXP_ID_SKIPPED, /** < Unlock request for frame exp_id skipped.
+		A request was received to unlock a frame that is currently being captured.
+		This warning can be avoided by unlocking a marked frame only after receiving
+		the frame done event.*/
 };
 
 #endif /* __IA_CSS_ERR_H */
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_frame_public.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_frame_public.h
index 78d5d1f..b737db0 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_frame_public.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_frame_public.h
@@ -37,6 +37,15 @@ enum ia_css_bayer_order {
 };
 #define IA_CSS_BAYER_ORDER_NUM (IA_CSS_BAYER_ORDER_GBRG + 1)
 
+/** For selecting appropriate sensor type. Future sensor types like
+*RGBC - RGBCLear, should be added here.
+*/
+enum ia_css_raw_type {
+	IA_CSS_RAW_BAYER, /**< Any of the 4 ia_css_bayer_order input pixel orders */
+	IA_CSS_RAW_RGBIR_IR_ON_Gr, /**< BGBGBGBGBG .. IrRIrRIrRIrRIrR */
+	IA_CSS_RAW_RGBIR_IR_ON_Gb, /**< BIrBIrBIrBIrBIr .. GRGRGRGRGR */
+};
+
 /** Frame plane structure. This describes one plane in an image
  *  frame buffer.
  */
@@ -113,6 +122,11 @@ struct ia_css_frame_info {
 					 only valid for RAW bayer frames */
 	enum ia_css_bayer_order raw_bayer_order; /**< bayer order, only valid
 						      for RAW bayer frames */
+	enum ia_css_raw_type raw_type; /**<To choose the proper raw frame type.
+						 for Legacy SKC pipes/Default is set to IA_CSS_RAW_BAYER.
+						 for RGB IR sensor - driver should set it to:
+						 IronGr case - IA_CSS_RAW_RGBIR_IR_ON_Gr
+						 IronGb case - IA_CSS_RAW_RGBIR_IR_ON_Gb*/
 	/* the params below are computed based on bayer_order
 	 * we can remove the raw_bayer_order if it is redundant
 	 * keeping it for now as bxt and fpn code seem to use it
@@ -128,6 +142,7 @@ struct ia_css_frame_info {
 	IA_CSS_FRAME_FORMAT_NUM, /* format */ \
 	0,                       /* raw_bit_depth */ \
 	IA_CSS_BAYER_ORDER_NUM,  /* raw_bayer_order */ \
+	IA_CSS_RAW_BAYER,        /* ia_css_raw_type */\
 	{0,                       /*start col */ \
 	 0},                       /*start line */ \
 }
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream.h
index 2647f15..05572c3 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream.h
@@ -43,6 +43,7 @@ struct ia_css_stream {
 	bool                           cont_capt;
 	bool                           disable_cont_vf;
 	bool                           started;
+	bool			       disable_preview_on_capture;
 };
 
 /** @brief Get a binary in the stream, which binary has the shading correction.
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream_public.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream_public.h
index 0813d3f..acca403 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream_public.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_stream_public.h
@@ -81,6 +81,11 @@ struct ia_css_stream_input_config {
 					       format will be mapped to MIPI data
 					       type internally. */
 	enum ia_css_bayer_order bayer_order; /**< Bayer order for RAW streams */
+	enum ia_css_raw_type raw_type; /**<To choose the proper raw frame type.
+						 for Legacy SKC pipes/Default is set to IA_CSS_RAW_BAYER.
+						 for RGB IR sensor - driver should set it to:
+						 IronGr case - IA_CSS_RAW_RGBIR_IR_ON_Gr
+						 IronGb case - IA_CSS_RAW_RGBIR_IR_ON_Gb */
 };
 
 
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_types.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_types.h
index 7d89d72..bb03958 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_types.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_types.h
@@ -1,4 +1,4 @@
-/* Release Version: irci_ecr-master_20160201_0200 */
+/* Release Version: irci_ecr-master_20160308_0202 */
 /**
 Support for Intel Camera Imaging ISP subsystem.
 Copyright (c) 2010 - 2015, Intel Corporation.
@@ -50,6 +50,7 @@ more details.
 #include "isp/kernels/macc/macc_1.0/ia_css_macc_types.h"
 #include "isp/kernels/macc/macc1_5/ia_css_macc1_5_types.h"
 #include "isp/kernels/dpc2/ia_css_dpc2_types.h"
+#include "isp/kernels/bnlm/ia_css_bnlm_types.h"
 #include "isp/kernels/eed1_8/ia_css_eed1_8_types.h"
 #include "isp/kernels/ob/ob_1.0/ia_css_ob_types.h"
 #include "isp/kernels/ob/ob2/ia_css_ob2_types.h"
@@ -575,6 +576,8 @@ struct ia_css_isp_config {
 							[MACC1.5, 2.7only]*/
 	struct ia_css_xnr3_0_11_config  *xnr3_0_11_config; /**< eXtra Noise Reduction
 								[XNR3_0_11] */
+	struct ia_css_bnlm_config    *bnlm_config;    /**< Bayer Non-Linear Mean
+							[BNLM, 2.7only] */
 
 	struct ia_css_2500_lin_kernel_config     *lin_2500_config;       /**< Skylake: Linearization config */
 	struct ia_css_2500_obgrid_kernel_config  *obgrid_2500_config;    /**< Skylake: OBGRID config */
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_version_data.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_version_data.h
index 507327d..e71f903 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_version_data.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/ia_css_version_data.h
@@ -22,7 +22,7 @@ more details.
 #define __IA_CSS_VERSION_DATA_H
 
 
-#define CSS_VERSION_STRING "REL:20160201_05.1_0706; API:2.1.21.0; GIT:irci___#09dd1c081bd713156857f504b396669f7415e397; SDK:; USER:viedifw; "
+#define CSS_VERSION_STRING "REL:20160308_10.2_0657; API:2.1.21.3; GIT:irci___#38d89cfd197cf4155d8ff30fec5762e02efd68aa; SDK:; USER:viedifw; "
 
 
 #endif
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.c
index 7c140af..b0ccddb 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.c
@@ -20,17 +20,18 @@ more details.
 #endif
 #include <assert_support.h>
 
-#define BNLM_DIV_LUT_SIZE	(12)
+#define BNLM_MAX_NUM_LUT_ENTRIES	(16)
+#define BNLM_DIV_LUT_SIZE	(16)
 static const int32_t div_lut_nearests[BNLM_DIV_LUT_SIZE] = {
-	0, 454, 948, 1484, 2070, 2710, 3412, 4184, 5035, 5978, 7025, 8191
+	0, 454, 948, 1484, 2070, 2710, 3412, 4184, 5035, 5978, 7025, 8191, 8191, 8191, 8191, 8191
 };
 
 static const int32_t div_lut_slopes[BNLM_DIV_LUT_SIZE] = {
-	-7760, -6960, -6216, -5536, -4912, -4344, -3832, -3360, -2936, -2552, -2208, -2208
+	-7760, -6960, -6216, -5536, -4912, -4344, -3832, -3360, -2936, -2552, -2208, -2208, -2208, -2208, -2208, -2208
 };
 
 static const int32_t div_lut_intercepts[BNLM_DIV_LUT_SIZE] = {
-	8184, 7752, 7336, 6928, 6536, 6152, 5776, 5416, 5064, 4728, 4408, 4408
+	8184, 7752, 7336, 6928, 6536, 6152, 5776, 5416, 5064, 4728, 4408, 4408, 4408, 4408, 4408, 4408
 };
 
 /* Encodes a look-up table from BNLM public parameters to vmem parameters.
@@ -80,7 +81,7 @@ bnlm_lut_encode(struct bnlm_lut *lut, const int32_t *lut_thr, const int32_t *lut
 	/* Copy data from first block to all blocks */
 	for (blk = 1; blk < total_blocks; blk++) {
 		uint32_t blk_offset = blk * block_size;
-		for (i = 1; i < lut_size; i++) {
+		for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++) {
 			lut->thr[0][blk_offset + i] = lut->thr[0][i];
 			lut->val[0][blk_offset + i] = lut->val[0][i];
 		}
@@ -98,18 +99,21 @@ ia_css_bnlm_vmem_encode(
 			size_t size)
 {
 	int i;
+	uint32_t blk;
+	const uint32_t block_size = 16;
+	const uint32_t total_blocks = (ISP_VEC_NELEMS / block_size);
 	(void)size;
 
 	/* Initialize LUTs in VMEM parameters */
-	bnlm_lut_encode(&to->mu_root_lut, from->mu_root_lut_thr, from->mu_root_lut_val, 16);
-	bnlm_lut_encode(&to->sad_norm_lut, from->sad_norm_lut_thr, from->sad_norm_lut_val, 16);
-	bnlm_lut_encode(&to->sig_detail_lut, from->sig_detail_lut_thr, from->sig_detail_lut_val, 16);
-	bnlm_lut_encode(&to->sig_rad_lut, from->sig_rad_lut_thr, from->sig_rad_lut_val, 16);
-	bnlm_lut_encode(&to->rad_pow_lut, from->rad_pow_lut_thr, from->rad_pow_lut_val, 16);
-	bnlm_lut_encode(&to->nl_0_lut, from->nl_0_lut_thr, from->nl_0_lut_val, 16);
-	bnlm_lut_encode(&to->nl_1_lut, from->nl_1_lut_thr, from->nl_1_lut_val, 16);
-	bnlm_lut_encode(&to->nl_2_lut, from->nl_2_lut_thr, from->nl_2_lut_val, 16);
-	bnlm_lut_encode(&to->nl_3_lut, from->nl_3_lut_thr, from->nl_3_lut_val, 16);
+	bnlm_lut_encode(&to->mu_root_lut, from->mu_root_lut_thr, from->mu_root_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->sad_norm_lut, from->sad_norm_lut_thr, from->sad_norm_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->sig_detail_lut, from->sig_detail_lut_thr, from->sig_detail_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->sig_rad_lut, from->sig_rad_lut_thr, from->sig_rad_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->rad_pow_lut, from->rad_pow_lut_thr, from->rad_pow_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->nl_0_lut, from->nl_0_lut_thr, from->nl_0_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->nl_1_lut, from->nl_1_lut_thr, from->nl_1_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->nl_2_lut, from->nl_2_lut_thr, from->nl_2_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
+	bnlm_lut_encode(&to->nl_3_lut, from->nl_3_lut_thr, from->nl_3_lut_val, BNLM_MAX_NUM_LUT_ENTRIES);
 
 	/* Initialize arrays in VMEM parameters */
 	memset(to->nl_th, 0, sizeof(to->nl_th));
@@ -123,15 +127,39 @@ ia_css_bnlm_vmem_encode(
 	to->match_quality_max_idx[0][2] = from->match_quality_max_idx[2];
 	to->match_quality_max_idx[0][3] = from->match_quality_max_idx[3];
 
-	bnlm_lut_encode(&to->div_lut, div_lut_nearests, div_lut_slopes, BNLM_DIV_LUT_SIZE);
+	/* div lut - nearest, slopes and intercepts */
 	memset(to->div_lut_intercepts, 0, sizeof(to->div_lut_intercepts));
-	for(i = 0; i < BNLM_DIV_LUT_SIZE; i++) {
+	memset(to->div_lut.thr, 0, sizeof(to->div_lut.thr));
+	memset(to->div_lut.val, 0, sizeof(to->div_lut.val));
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++) {
 		to->div_lut_intercepts[0][i] = div_lut_intercepts[i];
+		to->div_lut.thr[0][i] = div_lut_nearests[i];
+		to->div_lut.val[0][i] = div_lut_slopes[i];
 	}
 
+	/* Power of 2 */
 	memset(to->power_of_2, 0, sizeof(to->power_of_2));
-	for (i = 0; i < (ISP_VEC_ELEMBITS-1); i++) {
-		to->power_of_2[0][i] = 1 << i;
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++) {
+		if (i < ISP_VEC_ELEMBITS - 1) {
+			to->power_of_2[0][i] = 1 << i;
+		} else {
+			/* pad remaining entries with last valid entry */
+			to->power_of_2[0][i] = 1 << ((ISP_VEC_ELEMBITS - 1) - 1);
+		}
+	}
+
+	/* Copy div luts (nearest, slope, intercept and power_of_2) from
+	 * block[0] to blocks 1, 2 and 3
+	 */
+	for (blk = 1; blk < total_blocks; blk++) {
+		uint32_t blk_offset = blk * block_size;
+		for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++) {
+			to->div_lut.thr[0][blk_offset + i] = to->div_lut.thr[0][i];
+			to->div_lut.val[0][blk_offset + i] = to->div_lut.val[0][i];
+			to->div_lut_intercepts[0][blk_offset + i] = to->div_lut_intercepts[0][i];
+			to->power_of_2[0][blk_offset + i] = to->power_of_2[0][i];
+			to->match_quality_max_idx[0][blk_offset + i] = to->match_quality_max_idx[0][i];
+		}
 	}
 }
 
@@ -157,10 +185,13 @@ ia_css_bnlm_encode(
 
 /* Prints debug traces for BNLM public parameters */
 void
-ia_css_bnlm_debug_trace(
+ia_css_bnlm_debug_dtrace(
 	const struct ia_css_bnlm_config *config,
 	unsigned level)
 {
+#ifndef IA_CSS_NO_DEBUG
+	int i;
+#endif
 	if (!config)
 		return;
 
@@ -177,7 +208,106 @@ ia_css_bnlm_debug_trace(
 	ia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_coeff_c", config->exp_coeff_c);
 	ia_css_debug_dtrace(level, "\t%-32s = %d\n", "exp_exponent", config->exp_exponent);
 
-	/* ToDo: print traces for LUTs */
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_th");
+	for (i = 0; i < 3; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_th[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "match_quality_max_idx");
+	for (i = 0; i < 4; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->match_quality_max_idx[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "mu_root_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->mu_root_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "mu_root_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->mu_root_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sad_norm_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sad_norm_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sad_norm_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sad_norm_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sig_detail_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sig_detail_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sig_detail_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sig_detail_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sig_rad_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sig_rad_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "sig_rad_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->sig_rad_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "rad_pow_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->rad_pow_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "rad_pow_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->rad_pow_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_0_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_0_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_0_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_0_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_0_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_0_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_0_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_0_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_1_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_1_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_1_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_1_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_2_lut_thr");
+	for (i = 0; i < (BNLM_MAX_NUM_LUT_ENTRIES - 1); i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_2_lut_thr[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
+	ia_css_debug_dtrace(level, "\t%-32s = {", "nl_3_lut_val");
+	for (i = 0; i < BNLM_MAX_NUM_LUT_ENTRIES; i++)
+		ia_css_debug_dtrace(level, "%d, ", config->nl_3_lut_val[i]);
+	ia_css_debug_dtrace(level, "}\n");
+
 #endif /* IA_CSS_NO_DEBUG */
 
 }
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.h
index 13de96e..92443cc 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm.host.h
@@ -33,7 +33,7 @@ ia_css_bnlm_encode(
 
 #ifndef IA_CSS_NO_DEBUG
 void
-ia_css_bnlm_debug_trace(
+ia_css_bnlm_debug_dtrace(
 	const struct ia_css_bnlm_config *config,
 	unsigned level);
 #endif
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_default.host.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_default.host.c
index 911c791..9802c0c 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_default.host.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_default.host.c
@@ -17,8 +17,8 @@ more details.
 const struct ia_css_bnlm_config default_bnlm_config = {
 
 	.rad_enable = true,
-	.rad_x_origin = 0,
-	.rad_y_origin = 0,
+	.rad_x_origin = -1640,
+	.rad_y_origin = -1232,
 	.avg_min_th = 127,
 	.max_min_th = 2047,
 
@@ -27,8 +27,8 @@ const struct ia_css_bnlm_config default_bnlm_config = {
 	.exp_coeff_c = 0,
 	.exp_exponent = 3,
 
-	.nl_th = {2252, 2251, 2250},
-	.match_quality_max_idx = {2, 3, 3, 1},
+	.nl_th = {90, 22, 11},
+	.match_quality_max_idx = {3, 3, 3, 1},
 
 	.mu_root_lut_thr = {
 		26, 56, 128, 216, 462, 626, 932, 1108, 1480, 1564, 1824, 1896, 2368, 3428, 4560},
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_types.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_types.h
index 51fb972..700a5d3 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_types.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/bnlm/ia_css_bnlm_types.h
@@ -27,16 +27,16 @@ more details.
  * \details Struct with all parameters for the BNLM kernel that can be set
  * from the CSS API.
  *
- * ISP2.6.1: BNLM is used.
+ * ISP2.7: BNLM is used.
  */
 struct ia_css_bnlm_config {
 	bool		rad_enable;	/**< Enable a radial dependency in a weight calculation */
 	int32_t		rad_x_origin;	/**< Initial x coordinate for a radius calculation */
 	int32_t		rad_y_origin;	/**< Initial x coordinate for a radius calculation */
-	/* a threshold for average of weights if this < Th, do not denoise pixel */
-	int32_t		avg_min_th;
-	/* minimum weight for denoising if max < th, do not denoise pixel */
-	int32_t		max_min_th;
+	int32_t		avg_min_th;	/**< Threshold for avg of weights. if this < Th
+					  * do not denoise pixel */
+	int32_t		max_min_th;	/**< min weight for denoising. if max < th,
+					 * do not denoise pixel */
 
 	/**@{*/
 	/** Coefficient for approximation, in the form of (1 + x / N)^N,
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/tdf/tdf_1.0/ia_css_tdf.host.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/tdf/tdf_1.0/ia_css_tdf.host.c
index 9d8638a..1d9b6c8 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/tdf/tdf_1.0/ia_css_tdf.host.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/kernels/tdf/tdf_1.0/ia_css_tdf.host.c
@@ -11,7 +11,8 @@ ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
 FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
 more details.
 */
-
+#include "ia_css_types.h"
+#include "sh_css_defs.h"
 #include "ia_css_debug.h"
 #include "ia_css_tdf.host.h"
 
@@ -73,4 +74,3 @@ ia_css_tdf_debug_dtrace(
 	(void)config;
 	(void)level;
 }
-
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/modes/interface/isp_const.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/modes/interface/isp_const.h
index bdb817d..1cfa8f7 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/modes/interface/isp_const.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/isp/modes/interface/isp_const.h
@@ -100,13 +100,14 @@ more details.
 #define SH_CSS_BINARY_ID_VIDEO_DZ_ISP2_MIN      53
 #define SH_CSS_BINARY_ID_VIDEO_DZ_ISP2          54
 #define SH_CSS_BINARY_ID_VIDEO_LP_ISP2          55
-#define SH_CSS_BINARY_ID_RESERVED1              56
-#define SH_CSS_BINARY_ID_ACCELERATION           57
-#define SH_CSS_BINARY_ID_PRE_DE_ISP2            58
-#define SH_CSS_BINARY_ID_KERNEL_TEST_LOAD_STORE 59
-#define SH_CSS_BINARY_ID_CAPTURE_PP_BLI         60
-#define SH_CSS_BINARY_ID_CAPTURE_PP_LDC         61
-#define SH_CSS_BINARY_ID_PRIMARY_STRIPED_ISP2_XNR      62
+#define SH_CSS_BINARY_ID_VIDEO_DZ_ISP2_MIN_DVS  56
+#define SH_CSS_BINARY_ID_RESERVED1              57
+#define SH_CSS_BINARY_ID_ACCELERATION           58
+#define SH_CSS_BINARY_ID_PRE_DE_ISP2            59
+#define SH_CSS_BINARY_ID_KERNEL_TEST_LOAD_STORE 60
+#define SH_CSS_BINARY_ID_CAPTURE_PP_BLI         61
+#define SH_CSS_BINARY_ID_CAPTURE_PP_LDC         62
+#define SH_CSS_BINARY_ID_PRIMARY_STRIPED_ISP2_XNR      63
 
 /* skycam kerneltest pipelines */
 #define SH_CSS_BINARY_ID_VIDEO_KERNELTEST_NORM              121
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/interface/ia_css_frame_comm.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/interface/ia_css_frame_comm.h
index 68639e1..f299276 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/interface/ia_css_frame_comm.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/interface/ia_css_frame_comm.h
@@ -78,7 +78,12 @@ struct ia_css_frame_sp_info {
 					only valid for RAW bayer frames */
 	unsigned char raw_bayer_order;	/* bayer order, only valid
 					for RAW bayer frames */
-	unsigned char padding[3];	/* Extend to 32 bit multiple */
+	unsigned char raw_type; /*To choose the proper raw frame type.
+						 for Legacy SKC pipes/Default is set to IA_CSS_RAW_BAYER.
+						 for RGB IR sensor - driver should set it to:
+						 IronGr case - IA_CSS_RAW_RGBIR_IR_ON_Gr
+						 IronGb case - IA_CSS_RAW_RGBIR_IR_ON_Gb */
+	unsigned char padding[2];	/* Extend to 32 bit multiple */
 };
 
 struct ia_css_buffer_sp {
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/src/frame.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/src/frame.c
index 8f8817d..1011350 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/src/frame.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/frame/src/frame.c
@@ -899,6 +899,7 @@ void ia_css_frame_info_to_frame_sp_info(
 	to->format = (uint8_t)from->format;
 	to->raw_bit_depth = (uint8_t)from->raw_bit_depth;
 	to->raw_bayer_order = from->raw_bayer_order;
+	to->raw_type = from->raw_type;
 }
 
 void ia_css_resolution_to_sp_resolution(
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/tagger/interface/ia_css_tagger_common.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/tagger/interface/ia_css_tagger_common.h
index a9d76f1..c7dedfe 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/tagger/interface/ia_css_tagger_common.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/runtime/tagger/interface/ia_css_tagger_common.h
@@ -38,6 +38,7 @@ typedef struct {
 	uint8_t mark;	/* the mark on the element */
 	uint8_t lock;	/* the lock on the element */
 	uint8_t exp_id; /* exp_id of frame, for debugging only */
+	uint8_t capture;/* elem busy on capture pipe */
 } ia_css_tagger_buf_sp_elem_t;
 
 #endif /* __IA_CSS_TAGGER_COMMON_H__ */
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css.c
index 1bb5c05..006e7fa 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css.c
@@ -4837,8 +4837,11 @@ ia_css_dequeue_psys_event(struct ia_css_event *event)
 	} else if (event->type == IA_CSS_EVENT_TYPE_FW_WARNING) {
 		event->fw_warning = (enum ia_css_fw_warning)payload[1];
 		/* exp_id is only available in these warning types */
-		if (event->fw_warning == IA_CSS_FW_WARNING_EXP_ID_LOCKED ||
-		    event->fw_warning == IA_CSS_FW_WARNING_TAG_EXP_ID_FAILED)
+		if ((event->fw_warning == IA_CSS_FW_WARNING_EXP_ID_LOCKED) ||
+		    (event->fw_warning == IA_CSS_FW_WARNING_TAG_EXP_ID_FAILED) ||
+		    (event->fw_warning == IA_CSS_FW_WARNING_UNLOCK_EXP_ID_FAILED) ||
+		    (event->fw_warning == IA_CSS_FW_WARNING_UNLOCK_EXP_ID_SKIPPED) ||
+		    (event->fw_warning == IA_CSS_FW_WARNING_CAPTURE_EXP_ID_FAILED))
 			event->exp_id = payload[3];
 	} else if (event->type == IA_CSS_EVENT_TYPE_FW_ASSERT) {
 		event->fw_assert_module_id = payload[1]; /* module */
@@ -9713,8 +9716,13 @@ ia_css_stream_create(const struct ia_css_stream_config *stream_config,
 	}
 	/* store pipes */
 	spcopyonly = (num_pipes == 1) && (pipes[0]->config.mode == IA_CSS_PIPE_MODE_COPY);
-	for (i = 0; i < num_pipes; i++)
+	for (i = 0; i < num_pipes; i++) {
+		if (pipes[i]->config.mode == IA_CSS_PIPE_MODE_CAPTURE &&
+		    pipes[i]->config.isp_pipe_version == IA_CSS_PIPE_VERSION_2_7) {
+			curr_stream->disable_preview_on_capture = true;
+		}
 		curr_stream->pipes [i] = pipes[i];
+	}
 	curr_stream->last_pipe = curr_stream->pipes[0];
 	/* take over stream config */
 	curr_stream->config = *stream_config;
@@ -9741,6 +9749,8 @@ ia_css_stream_create(const struct ia_css_stream_config *stream_config,
 	if (curr_stream->config.ia_css_enable_raw_buffer_locking)
 		sh_css_sp_configure_enable_raw_pool_locking(
 					curr_stream->config.lock_all);
+        if (curr_stream->config.disable_cont_viewfinder && curr_stream->disable_preview_on_capture)
+                sh_css_sp_set_disable_preview_on_capture(curr_stream->disable_preview_on_capture);
 
 	/* copy mode specific stuff */
 	switch (curr_stream->config.mode) {
@@ -9796,6 +9806,7 @@ ia_css_stream_create(const struct ia_css_stream_config *stream_config,
 		curr_pipe = pipes[i];
 		/* set current stream */
 		curr_pipe->stream = curr_stream;
+		curr_pipe->in_frame_struct.info.raw_type = curr_pipe->stream->config.input_config.raw_type;
 		/* take over effective info */
 
 		effective_res = curr_pipe->config.input_effective_res;
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_firmware.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_firmware.c
index 1c7228d..e626676 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_firmware.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_firmware.c
@@ -47,10 +47,10 @@ struct fw_param {
 /* Warning: same order as SH_CSS_BINARY_ID_* */
 static struct firmware_header *firmware_header;
 
-/* The string STR(irci_ecr-master_20160201_0200) is a place holder
+/* The string STR(irci_ecr-master_20160308_0202) is a place holder
  * which will be replaced with the actual RELEASE_VERSION
  * during package generation. Please do not modify  */
-static const char *release_version = STR(irci_ecr-master_20160201_0200);
+static const char *release_version = STR(irci_ecr-master_20160308_0202);
 
 #define MAX_FW_REL_VER_NAME	300
 static char FW_rel_ver_name[MAX_FW_REL_VER_NAME] = "---";
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_internal.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_internal.h
index 1573f7b..5daddb5 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_internal.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_internal.h
@@ -455,6 +455,7 @@ struct sh_css_sp_config {
 	uint8_t                 enable_isys_event_queue;
 #endif
 	uint8_t			disable_cont_vf;
+	uint8_t			disable_preview_on_capture;
 };
 
 enum sh_css_stage_type {
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_param_shading.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_param_shading.c
index dff03f3..1902abc 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_param_shading.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_param_shading.c
@@ -114,11 +114,6 @@ crop_and_interpolate(unsigned int cropped_width,
 	out_cell_size = CEIL_DIV(padded_width, out_table->width - 1);
 	in_cell_size  = CEIL_DIV(sensor_width, table_width - 1);
 
-	if (0 == in_cell_size) {
-		assert(in_cell_size != 0);
-		return;
-	}
-
 	out_start_col = ((int)sensor_width - (int)cropped_width)/2 - left_padding;
 	out_start_row = ((int)sensor_height - (int)cropped_height)/2 - top_padding;
 	table_cell_w = (int)((table_width-1) * in_cell_size);
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.c
index 5331cfb..5193e89 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.c
@@ -69,6 +69,7 @@ more details.
 #include "fpn/fpn_1.0/ia_css_fpn.host.h"
 #include "gc/gc_1.0/ia_css_gc.host.h"
 #include "dpc2/ia_css_dpc2.host.h"
+#include "bnlm/ia_css_bnlm.host.h"
 #include "eed1_8/ia_css_eed1_8.host.h"
 #include "iefd2_6/ia_css_iefd2_6.host.h"
 #include "macc/macc_1.0/ia_css_macc.host.h"
@@ -3395,6 +3396,7 @@ sh_css_init_isp_params_from_global(struct ia_css_stream *stream,
 		ia_css_set_dp_config(params, &default_dp_config);
 		ia_css_set_eed1_8_config(params, &default_eed1_8_config);
 		ia_css_set_iefd2_6_config(params, &default_iefd2_6_config);
+		ia_css_set_bnlm_config(params, &default_bnlm_config);
 
 		for (i = 0; i < stream->num_pipes; i++) {
 			if (IA_CSS_SUCCESS == sh_css_select_dp_10bpp_config(stream->pipes[i], &is_dp_10bpp)) {
@@ -3516,6 +3518,7 @@ sh_css_init_isp_params_from_global(struct ia_css_stream *stream,
 		ia_css_set_xnr3_0_11_config(params, &stream_params->xnr3_0_11_config);
 		ia_css_set_eed1_8_config(params, &stream_params->eed1_8_config);
 		ia_css_set_iefd2_6_config(params, &stream_params->iefd2_6_config);
+		ia_css_set_bnlm_config(params, &stream_params->bnlm_config);
 		ia_css_set_formats_config(params, &stream_params->formats_config);
 
 		for (i = 0; i < stream->num_pipes; i++) {
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.h
index 9e2e192..5b604f3 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_params.h
@@ -136,6 +136,7 @@ struct ia_css_isp_parameters {
 	struct ia_css_macc1_5_config macc1_5_config;
 	struct ia_css_macc1_5_table macc1_5_table;
 	struct ia_css_xnr3_0_11_config   xnr3_0_11_config;
+	struct ia_css_bnlm_config    bnlm_config;
 
 	bool isp_params_changed;
 	bool isp_mem_params_changed
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.c b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.c
index fd97221..f9c4fe1 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.c
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.c
@@ -745,6 +745,12 @@ sh_css_sp_set_disable_continuous_viewfinder(bool flag)
 	sh_css_sp_group.config.disable_cont_vf = flag;
 }
 
+void
+sh_css_sp_set_disable_preview_on_capture(bool flag)
+{
+	sh_css_sp_group.config.disable_preview_on_capture = flag;
+}
+
 static enum ia_css_err
 sh_css_sp_write_frame_pointers(const struct sh_css_binary_args *args)
 {
diff --git a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.h b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.h
index b80ddc0..85160fe 100644
--- a/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.h
+++ b/drivers/external_drivers/camera/drivers/media/pci/atomisp2/css/sh_css_sp.h
@@ -206,6 +206,9 @@ void
 sh_css_sp_set_disable_continuous_viewfinder(bool flag);
 
 void
+sh_css_sp_set_disable_preview_on_capture(bool flag);
+
+void
 sh_css_sp_reset_global_vars(void);
 
 /**
-- 
1.9.1

